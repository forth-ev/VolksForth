+                                                    clv 25apr89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ kleine Utilities                                   clv 13jun89\needs loads  4 load   (                                        \\ )                                                                                                          2 Loads "[          3 Loads leap         5 Loads instr                              6 Loads unget        7 Loads stay           8 Loads LATER      &9 Loads Chain                             &11 Loads move>r    &12 Loads #left      &13 Loads s>r          &14 Loads p@        &15 Loads .datim     &16 Loads exec:        &17 Loads pushVideo &18 Loads Video      &19 Loads ibm-at?      &20 Loads msgError  &21 Loads scopy      &24 Loads no-headers   &25 Loads callForth &26 Loads #dup       &27 Loads link         &28 Loads cycle     &29 Loads Appendfile &30 Loads saveStdI/O   &31 Loads JCS       &32 Loads top?       &33 Loads saveemit                                                                                                                                                         \ s[ ]s                                              clv 20apr89                                                                  : ]"  &66 ?pairs  here 1- over - swap c!  ] ;                                                                                   : "[  compile ("  here 0 c,  &66  [compile] [                      ; immediate restrict                                                                                                       \\ Benutzt in der Form                                              : <name> .... "[  ... , ... c, ," ...." ]" ... ;               Die Zwischen "[ und ]" im Dictionary abgelegten Werte           erscheinen wie durch " ... " abgelegt.                                                                                           : dump-str ( str-- )                                               count bounds DO cr I . I c@ dup . emit LOOP ;                : test ." Test"  "[ ," Test" 23 c,  Ascii # c, ]" dump-str ;                                                                \ leap                                               clv 20apr89                                                                : leap  rdrop rdrop rdrop rdrop ; restrict                                                                                      \\ Benutzt in der Form                                              : <name> .... DO ..... leap ...... LOOP .... ;                 Kehrt sofort zum rufenden Wort zurÅck                                                                                           Beispiel                                                         : t  3 0 DO cr I . ." Press Return to LEAP"                                  key #cr = IF leap THEN ." ..weiter" LOOP             ." End of t" ;                                                                                                                : tt ." >>>" t ." <<<" ;                                                                                                                                                                    \ Loads                                              clv 16mai89                                                                  : Loads ( u -- )                                                    Create isfile@ 2- , ,  immediate                               does> state @ abort" not LOADed"                                 warning dup push off                                            pushfile dup perform open 2+ @ load ;                                                                                     | 0 Loads loadscfa                                                : ;load ;                                                       : load: BEGIN ' dup ['] ;load - WHILE                                     dup @ [ ' loadscfa @ ] Literal =                                IF execute ELSE drop THEN REPEAT drop ;             \\ Beispiel                                                     load: words leap "[ noop ;load                                    LÑdt leap und "[ falls sie mit Loads deklariert wurden.       \ instr                                              clv 20apr89                                                                Load: leap ;load                                                                                                                  : cinstr ( 8b str -- c false / pos true )                          count 0                                                         DO 2dup I + c@ = IF 2drop I true leap THEN LOOP                 drop false ;                                                 : instr ( 16b str -- 16b false / pos true )                        count 0                                                         DO 2dup I + @ = IF 2drop I 2/ true leap THEN 2 +LOOP            drop false ;                                               \\ Sucht KEY in STRing                                                                                                             : t ( u--) " 0123456789abcd" instr cr IF . ELSE ." no" THEN ;   ascii a t  \ 10                                              \ get unget                                          clv 20apr89                                                                  Defer get  ' key Is get                                         Variable lstKey                                                                                                                 : lst    ( -- c ) lstKey @  ['] key Is get ;                    : unget  ( c -- ) lstKey !  ['] lst Is get ;                                                                                  \\ GET ersetzt KEY.                                                Mit UNGET kann ein Zeichen in den Input zurÅckgegeben werden.                                                                                                                                                                                                                                                                                                                                                                                                \ stay                                               clv 02mai89                                                                load: leap LATER exec: ;load                                      : stay r>  at? >r >r  >r LATER r> r> at ; restrict                                                                            \ Saves Cursor-Position and restores it after                   \  calling word is finished                                                                                                       : stayAt  [ exec: stay r@ ;exec ] Literal                          r0 @ rp@ 4+                                                     DO I @ case? IF I 2+ @ I 4+ @ at leap THEN LOOP drop ;     \ Sets cursor at position saved by last STAY which was not      \ in calling word                                               \\ sample for stay                                                : t   ." t-1 " stay  invers 10 10 at ." t-2" normal ;         \ the ok will be printed behind t-1                             \ LATER                                              clv 20apr89                                                                  : LATER  r> r> swap >r >r ; restrict                                                                                                                                                          \\                                                                                                                                : t1  cr ." t1-1" LATER cr ." t1-2" ;                           : t   cr ." t-1"  t1    cr ." t-2 " ;                                                                                         \ outputs:  t-1 t1-1 t-2 t1-2                                                                                                                                                                                                                                                                                                                                                                   \ Chain                                              clv 25apr89                                                                  : Chain  ( | name -- ) Variable ;                               : append  ( l ele -- )  over @ over !  swap ! ;                 : append, ( l -- )  here 2 allot  append ;                      : >first ( l -- ele ) @ ;                                       : >next  ( l -- ele ) @ ;                                       : allchain ( l cfa -- )                                            >r @ BEGIN ?dup WHILE dup r@ execute @ REPEAT rdrop ;        : .chain ( l -- )  ['] u. allchain ;                                                                                          \\ z.B.:                                                           : x ( n list -- n+1 list ) 2dup append, ,  swap 1+ swap ;       Chain t  0 t  x x x x x   2drop                                 : .x  ( adr -- ) cr dup u. ." :" 2+ @ u. ;                      : .t  t dup u. ." : ---list----"  ['] .x allchain ;                                                               clv 18mai89                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ rallot #rdrop move>r r>copy                        clv 02mai89                                                                  : rallot ( n -- ) r> swap  rp@ swap - rp! >r ; restrict         : move>r ( adr count -- )                                          r> -rot  dup rallot  rp@ swap cmove >r ; restrict            : r>move ( adr count -- )                                          r> -rot  under  rp@ -rot cmove  negate rallot >r ; restrict  : r>copy ( adr count -- )                                          r> -rot  rp@ -rot cmove  >r ; restrict                       : rpick  ( n -- ) 1+ 2* rp@ + @ ;                                                                                             \\                                                              : .rs  r0 @ rp@ DO I @ u. 2 +LOOP ;                                                                                                                                                                                                                             \ #right #left bell                                  clv 08jun89                                                                   -77 Constant #right                                             -75 Constant #left                                              -80 Constant #down                                              -72 Constant #up                                                -83 Constant #del                                                27 Constant #esc                                                26 Constant #eof                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \ Stack<>Returnstack                                 clv 25apr89\ungetestet                                                       : sallot ( n -- ) >r sp@ r> - sp! ;                             : s>r    ( u -- )                                                  2* dup rallot                                                   sp@ 2+  rp@  2 pick cmove   negate sallot ;                  : r>s    ( u -- )                                                  2* dup >r sallot                                                rp@ 2+  sp@ r@ cmove     r> negate rallot ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ p@ p!                                              clv 10mai89                                                                Code p@ ( addr -- 16b )  D in  A D mov  next  end-code                                                                          Code p! ( 16b addr -- )                                                 A pop  D out  D pop  next end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \ .datim datim                                       clv 01jun89                                                                | : "("  Ascii (  hold ;          : ")"  Ascii )  hold ;        | : "---" 3 0 DO Ascii -  hold LOOP ;                           | : ##  ( u -- ) 0 # # 2drop ;                                  | : ##. ( u -- ) ##  Ascii .  hold ;                            | : ##: ( u -- ) ##  Ascii :  hold ;                              : datim ( -- adr count )                                           <# ")" time@ swap rot ##: ##: ## "---"                                 date@          ##. ##. ## "(" 0. #> ;                 : .datim     datim type ;                                       : ,"datim"   datim here over 1+ allot place ;                   : "datim"    compile ("  ,"datim" ; immediate restrict                                                                        \ Gibt Datum aus im Format:  (27.04.89---10:03:16).                                                                             \  exec:                                             clv 02mai89                                                                  : exec: here ] ;                                                : ;exec compile unnest  [compile] [ dup dp !  >r                   ; immediate restrict                                                                                                                                                                        \\ geht nicht                                                    : (:  ( | ..words.. -- cfa sys )  here  ['] : ,  ] 5 ;          : ;)  ( sys -- )  5 ?pairs  [compile] [ ; immediate restrict    : ;)exec  ( cfa sys -- )                                           [compile] ;) dup dp ! 2+ >r ; immediate restrict             : exec: ( -- sys )  (: drop 5 ;                                                                                                                                                                                                                               \ Video  pushvideo                                   clv 09mai89                                                                load: LATER ;load                                                                                                               \needs cursor  ' cur! 6 + @ Alias cursor                                                                                          : pushvideo  r>  savevideo >r  at? >r >r                                         area @ >r  cursor @ >r   >r                           LATER r> cursor !  r> area !  r> r> at                                r> restorevideo ;                                                                                                \\ : t ."  t1" pushvideo page ."  t2" key drop ;                                                                                                                                                                                                                                                                                \ Video                                              clv 16mai89                                                                \needs cursor  ' cur! 6 + @ Alias cursor                                                                                          : Video   ( | name -- ) Create 0 ,   8 allot does> ;          \                                adr   area cursor row  col       : getvid ( adr -- ) dup @                                         IF                                                               dup @ restorevideo dup off 2+  dup @ area ! 2+                  dup @ cursor ! 2+              dup 2@ at 4+ THEN  drop ;                                                                     : putvid ( adr -- )                                                savevideo over ! 2+            area @ over ! 2+                 cursor @ over ! 2+             dup at? rot 2! 4+  drop ;     : .vid ( adr -- ) dup @ u. 2+  dup @ 2- >name .name 2+             dup @ 2- >name .name 2+     dup 2@ . . 4+ drop ;           \ ibm-at?                                            clv 09mai89                                                                  Code ibm-at?                                                     D push     R push  U push                                       B+ B+ xor  3 # A+ mov  $10 int                                  U pop  R pop                                                    A+ A+ xor  D+ A- mov  D+ D+ xor                                 A push                                                          next end-code                                                                                                                                                                                \ ibm-at? u. u. \ wirkt wie at? aber auf BIOS (absolut)                                                                                                                                                                                                                                                                         \ Fehlermeldungen in unterster Zeile                 clv 08jun89\ funktioniert                                                                                                                    Area: msg  msg   c/col 1- dup window page         terminal                                                                    | : pressEsc   at? drop &40 at                                       ." *** press Esc ***" bell BEGIN key $1b = UNTIL ;           : msgError ( string -- )   rdrop r> aborted !  standardi/o         area @ swap msg page  normal here .name   count type            underline pressEsc  normal page  area !                         blk @ ?dup IF  scr ! >in @ r# !  THEN  quit ;              \  ' msgError errorhandler !   status off  \ installieren       \ : .eh  errorhandler @ >name .name ;                           \ : .q   ['] 'quit >body @ >name .name ;                        \\ entfernen mit restart oder Editor aufrufen                      Ist als Demo fÅr errorhandler-verbiegen geeignet             \ copying with shadows                               clv 01jun89                                                                  Variable getscr  Variable getfile                             | : (shadow   capacity 2/ ;                                       : ?odd      capacity dup 2/ 2* - abort" odd capacity!" ;                                                                        : s     scr @ (shadow  2dup u< IF + ELSE - THEN scr ! ;         : ll    scr @ list ;                                            : gn    1 getscr +! ;           : gb -1 getscr +! ;             : gl    isFile push  getFile @ isFile ! getscr @ list ;         : getthis  isFile@ getfile !  scr @ getscr ! ;                  : wipe  scr @  block b/blk bl fill update flush ;                             \ flush, damit der Editor keine Stamp macht     -->                                                                                                                                                                                             \ copying with shadows                               clv 28jun89  : room  fromfile push  isFile@ fromfile !                          1 more  scr @ capacity 2- over 1+ convey  wipe ;             : get   fromfile push  getfile @ fromfile !                             getscr @  scr @ copy  gn  1 scr +! ;                    : thruwipe ( scr to.scr -- )  scr push                             2 arguments 2dup u> abort" nix-wipe!"  1+ swap                  ?DO I scr ! wipe LOOP ;                                      : indLin ( scr -- ) cr dup 3 u.r space  block c/l type ;        : index ( scr1 scr2 -- )                                           1+ swap ?DO stop? IF leave THEN I indLin LOOP ;                                                                              : sindex ( scr1 scr2 -- ) ?odd                                     1+ swap ?DO stop? IF leave THEN                                   cr I dup indLin (shadow + indLin LOOP ;                  -->                                                             \ copying with shadows                               clv 01jun89                                                                  : sconvey ( scr1 scr2 to.scr -- )                                  ?odd (shadow >r                                                 2 pick r@ +  2 pick r@ +  2 pick r@ + convey convey rdrop ;  : scopy ( scr to.scr -- )                                          ?odd (shadow >r                                                 over r@ +  over r@ +  copy copy rdrop ;                      : smore ( u -- )                                                  >r ?odd (shadow dup r@ + 1-  over dup 2* 1- over r@ +           r> 2* more convey thruwipe ;                                                                                                  : swipe ?odd s wipe s wipe ;                                    : sget  ?odd s get  s get  ;                                    : sroom ?odd s room s room ;                                                                                                  \ headers no-headers                                 clv 01jun89                                                                  ' | Alias old|                                                  Defer |  ' old| Is |                                                                                                            : headers    ?head off  ['] noop Is | ;                         : no-headers 1 ?head !  ['] old| Is | ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \ callForth tibMove callForth"                       clv 16mai89                                                                  : tibMove ( str -- )                                               count dup #tib !  tib swap cmove  >in off ;                                                                                  Create: back  r> r0 ! ;                                                                                                         : callForth   r0 @ >r  back >r  rp@ r0 !  restart ;             : continue    r0 @ rp! ;                                        : doForthLine ( str -- ??? ) tibmove interpret ;                                                                              \\ TIBMOVE steckt etwas in den Eingabestrom                        CALLFORTH startet Forth, es kann mit                              CONTINUE beim rufenden Wort fortgesetzt werden                DOFORTHLINE fÅhrt den Åbergebenen String aus. Bei einem            Fehler oder Ñhnlichem kann nicht fortgesetzt werden       \ #dup #drop #case?                                  clv 18mai89                                                                  : #dup ( u -- ) dup 0 ?DO dup pick swap LOOP drop ;             : #drop  ( u -- ) dup arguments 0 ?DO drop LOOP ;               : #case? ( ..u*16b1.. ..u*16b2.. u -- ..u*16b1.. 0 / true )        dup 1+ swap true swap 0 ( ... ... u+3 true u 0 )                ?DO dup IF >r dup pick rot - IF rdrop false >r THEN r>                        ELSE rot drop THEN LOOP                           IF 1- #drop true ELSE drop false THEN ;                                                                                    \\ 1001 2002 3003  cr .s 1 #dup .( -) .s 1 #drop .( -) .s                                                                       debug #case?                                                    \ 1 2 3 4 5 6 7  4 #dup  4 #case? .s                            \ 1 2 3 4 5 6 7  88 6 7  3 #case? .s                                                                                            \ link                                               clv 18mai89                                                                  Variable link   link off                                                                                                        : [link   link off ;                                            : lastlink ( -- adr ) link BEGIN dup @ WHILE @ REPEAT ;         : link,  here lastlink ! 0 , ;                                  : link]  link off ;                                           \\                                                               Defer (.link  ( adr -- adr )  ' noop Is (.link                 : .link ( adr-)                                                  cr BEGIN dup @ WHILE dup u. (.link @ ?cr stop? UNTIL drop ;    [link  Variable a link, 1 ,  link, 2 ,   link, 3 ,              link @  a !  link]                                              : .a ." :" dup 2+ @ . ;  ' .a Is (.link    a .link                                                                              \ cycle                                              clv 01jun89                                                                  : cycle  link @ lastlink  dup link = abort" cycle empty!"          ! ; \ benutzt vor link] aber bitte nur einmal!!!             : cycle+ ( link1 -- link2 ) @ ;                                 : cycle- ( link1 -- link2 )                                              dup @ BEGIN 2dup @ - WHILE @ REPEAT nip        ;       : cycle+! ( adr -- )  dup @ cycle+ swap ! ;                     : cycle-! ( adr -- )  dup @ cycle- swap ! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ openend AppendFile                                 clv 01jun89                                                                  : openEnd                                                          open  isfile@ [ dos ] f.size 2@  isfile@ [ dos ]   fseek ;                                                                   : AppendFile  >in @ name [ dos ] fsearch rot >in !                 IF makeFile ELSE Use THEN openEnd ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \ saveStdI/O saveStdOut saveStdIn                    clv 01jun89                                                                  : saveStdOut   output @                                            [ assembler u' output forth  origin + ] Literal ! ;                                                                          : saveStdIn    input @        \ ungetestet !                       [ assembler u' input  forth  origin + ] Literal ! ;                                                                          : saveStdI/O  saveStdOut saveStdIn ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ JCS JE                                             cîv 01jun89                                                                Assembler also definitions                                                                                                         : JE  ( adr -- )  0= not ?] ;                                   : JCS ( adr -- )  CS not ?] ;                                                                                                Onlyforth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \ top? ud? rl? topUd? cr? esc?                       clv 01jun89                                                                load: instr "[ #left ;load                                                                                                        : ud?  ( c--c 0 / 0 t / 1 t )  "[ #down  , #up , ]" instr ;     : rl?  ( c--c 0 / 0 t / 1 t )  "[ #left , #right , ]" instr ;   : top? ( c--c f )                                                 dup "[ #esc , #right , #left , ]" instr nip ;                 : topUd? ( c--c f )                                               dup "[ #esc , #right , #left , #down , #up , ]" instr nip ;   : cr? ( c--c 0 / true ) #cr case? ;                             : esc? ( c--c 0 / true ) #esc case? ;                           : eof? ( c--c 0 / true ) #eof case? ;                                                                                         \\ ein Ansatz zur Standardisierung von BenutzeroberflÑchen                                                                      \ saveemit savetype                                  clv 13jun89                                                                  : ?cr?  at? nip c/row u< ?exit cr ;                             : (emit  ?cr? (emit ;                                           : (type  ?cr? (type ;                                                                                                           ' (emit ' display   2 + !                                       ' (type ' display   6 + !                                       : saveemit ." already installed " ;                           \\ Dies beseitigt einen Fehler in MULTI.VID.                     Fehler in MULTI.VID: folgender Code Åberschreibt                folgende area                                                                                                                  : t1 BEGIN $30 emit stop? UNTIL ;                               : t2 BEGIN ." x"    stop? UNTIL ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               