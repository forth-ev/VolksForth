\\ Directory ultraFORTH 4of4   26oct87re                                          .                          0             ..                         0             C16-Tape-Demo              2             C64-Grafik-Demo            6             cload/csave              &13             Tape-Version:LoadScreen  &16             Ramdisk                  &21             Supertape                &32             auto-Decompiler          &51             Screentausch             &61             Grafik                   &64             Mathematik               &90             Sieve Benchmark         &138             Grafik-Demo             &144             Sprite-Demo             &160             Sprite-Data             &165             Sprite-Editor           &166                                                                                                                                                                                                                                                                  \\ Inhalt ultraFORTH 4of4      26oct87re                                          Directory                       0        Inhalt                          1                                                 C16-Tape  -Demo           &2-  &5        C64-Grafik-Demo           &6- &12        cload csave              &13- &15        Tape-Version:LoadScreen  &16- &20        Ramdisk                  &21- &30                                      &31 frei   Supertape                &32- &50        automatischer Decompiler &51- &60        Screens via UserPort C64 &61- &63        Grafik      nur C64 !!   &64- &88                                      &89 frei   Mathematik               &90- &96                                 &97-&100 frei   Tape Ramdisk Supertape  &101-&135 shadow                                          Sieve Benchmark              &138        Grafik-Demo nur C64 !!  &144-&155        Sprite-Demo nur C64 !!  &160-&164        Sprite-Data                  &165        Sprite Editor           &166-&168       \ DemoL:C16Tape-Demo ?dload   clv10oct87                                          \ Demo: insgesamt ca. 80 Screens !!!     \ prueft, ob ein Wort vorhanden ist:                                              | : exists? ( string--flag)                    cr capitalize dup find nip under         0= IF ." not " THEN ." found: "          count type ;                                                                \ Die letzte zugegriffene Diskette:                                               | Variable LastDisk   -1 LastDisk !                                               \ Laedt SCR von DISK, wenn das Wort      \ namens STRING noch nicht vorhanden     | : ?dload  ( string scr disk--)           2 pick exists?                           IF drop drop drop exit THEN              dup LastDisk @ -                         IF flush ."  Insert #" dup .                key drop  dup LastDisk ! THEN         drop ."  scr#" dup . cr                  load exists? 0= error" ???" ;          -->                                     \ DemoL:?reloc                clv10oct87                                          \ verschiebt das System ggf./ macht COLD | : ?reloc  ( s0 r0 limit --)             dup           limit =                    2 pick origin $a + @ = and               3 pick origin  8 + @ = and                                                        IF drop drop drop exit THEN                     ['] limit >body ! \ limit                    origin $A + ! \ r0               dup 6 + origin   1+ ! \ task                     origin  8 + ! \ s0            cold ;                                                                           \ Kompiliert Woerter, die erst spaeter   \ geladen werden.                        | : (forward"    "lit capitalize find     IF execute                               ELSE count type ."  unsatisfied" quit    THEN ; restrict                         | : forward"  compile (forward" ," ;      immediate  restrict                     -->                                                                              \ DemoL:64kb C16Demo          clv10oct87                                          \ stellt das System auf 64kB wenn vorh.                                           : 64kb $533 @ $fd00 -  ?dup               IF cr u. ." too small" exit THEN         limit $fd00 -                            IF $8000 $8400 $fd00 ?reloc THEN ;                                               \ wird als 'RESTART installiert:                                                  : c16demo  cr ." c16-Demo"                 forward" tapeinit"                       0 drive   forward" floppy"               cr ." Type 'help' to get help"           cr ." Type '64kb' to use 64kb" ;                                                                                                                                                                                                                                                                                                      -->                                                                              \ DemoL:C16DemoLoad          cclv14oct87                                          \ Dieses Wort laedt die komplette        \ Demo-Version. Wird als 'COLD install.  \ und installiert spaeter C16DEMO                                                 | : c16DemoLoad                            $9000 $9400 $c000 ?reloc                 Forth     " Code"       5 3 ?dload       Forth     " Editor"   $13 3 ?dload       Forth     " debug"    $2f 3 ?dload       Forth     " help"      $a 1 ?dload       Forth     " Tapeinit" $10 4 ?dload       ['] noop    Is 'cold                     ['] c16demo Is 'restart                  forward" Editor" forward" Ediboard"      1 scr !  0 r# !       save               $7a00 $7bf0 $8000 ?reloc ;                                                      ' c16DemoLoad Is 'cold  save                                                      cr .( Type : cold)                       cr .( after all: savesystem!!!)                                                                                           \ Graphik-Demo fuer C64        23oct87re                                          (16 .( Nicht fuer C16!) \\ C)                                                     Onlyforth                                                                         \needs buffers      .( Buffers?!)    \\  \needs demostart    .( Demostart?!)  \\  \needs tasks        .( Tasker??!)    \\  \needs help         .( help??!)      \\  \needs graphic      &58 +load            \needs .message2    1 2 +thru            Graphic also                             \needs moire        6 +load                                                       \needs slide  &154 +load  \ the Demo                                               3 5 +thru                                                                        1 Scr !  0 R# !                                                                   save                                                                                                                                                               \ demo-version                 06nov87re                                          | : (center."  "lit count                 C/L over - 2/ spaces type cr ;          restrict                                                                          | : c."  compile (center." ," ;          immediate restrict                                                                | : .FGes c." Forth Gesellschaft e.V." ;                                          | : .uF83  c." *** ultraFORTH-83 ***" ;                                           | : .(c)   c." (c) 1985/86/87"           c." Bernd Pennemann  Klaus Schleisiek"   c." Georg Rehfeld  Dietrich Weineck"     c." Claus Vogt" ;                                                                 | : .bezug   c." rainer mertins"                      c." antilopenstieg 6"             cr     c." 2000  hamburg 54"  ;                                             | : wait   BEGIN  key 3 -  UNTIL ;                                                                                        \ demo-version                 20oct87re                                          : .message1  ( -- )   singletask          page .uF83 cr .(c) cr                    c." Das Kopieren und Verschenken"        c." dieses Programms ist ausdruecklich"  cr c." * erlaubt ! *"                    cr c." Jeglichen Missbrauch zum"         c." Zwecke der Bereicherung"             c." werden wir nach besten Kraeften"     c." verfolgen und verhindern."           cr c." Die Mitglieder der" .FGes         multitask wait ;                                                                 : .message2  ( -- )                       page c." Du hast jetzt ein"              c." arbeitsfaehiges System mit"          c." Editor, Debugger und Assembler!"     c." Nach Einlegen einer formatierten"    c." Diskette kannst Du es mit"           c." SAVESYSTEM <name> (z.B. FORTH)"      c." als Programmfile abspeichern."       cr .uF83 cr                              c." Bezug und Mitgliedschaft in der"     .FGes c." ueber:" cr .bezug wait ;     \ demo-version                 20oct87re                                          graphic  also                                                                     | Variable end?                                                                   : killdemo  ( -)                          killsprites endslide                     singletask  .message2                    ['] 1541r/w Is r/w                       ['] noop Is 'cold                        ['] noop Is 'restart                     ['] (quit   Is 'quit                     nographic                                [ ' demostart >name 4 - ] Literal        (forget  save  &16 buffers ;                                                                                                                                                                                                                                                                                                                                                                                            \ demo-version                 06nov87re                                          | : demor/w  ( adr blk r/wf - f)          end? @  0 max  dup small  red colored    -1 end? +!  sprite push  killsprites     1541r/w ;                                                                        | : demoquit                               BEGIN .status cr query interpret          state @ IF   ."  compiling"                      ELSE ."  uF83" THEN              end? @ 0< dup                            IF drop                                   cr ." Kill the Demo? n/y "               key capital Ascii Y =                    dup not IF  del del del  THEN           THEN                                    UNTIL  killdemo ;                                                                                                                                                                                                                                                                                                                    \ demo-version                 20oct87re                                          : demonstration                           Onlyforth graphic                        ['] demor/w Is r/w                       ['] killdemo Is 'cold                    slide multitask pause   4 end? !         ['] demoquit Is 'quit                    ['] (error errorhandler !                ['] noop Is 'abort                       .message1  linien text                   key drop  moire text  key drop           ." help" row 1- 0 at abort ;                                                     ' demonstration Is 'cold                 ' killdemo Is 'restart                                                                                                                                                                                                                                                                                                                                                                                                   \ hires demo worte             06nov87re                                          : linien                                  clrscreen yel blu colors hires           &320 0 DO                                   &320 0 DO I &198 J 0 line &35 +LOOP   &35 +LOOP ;                                                                      : moire                                   clrscreen ora red colors hires           &320 0 DO                                 I &198 &319 I - 0 line                  3 +LOOP                                  &199 0 DO                                 &319 &198 I - 0 I line                  2 +LOOP ;                                                                                                                                                                                                                                                                                                                                                                                                               \ cSave cLoad..               clv10oct87                                          Onlyforth                                \needs Code   .( ?! Code ?!) quit                                                 $ff90 >label setMsg   $90 >label status  $ffba >label setlfs $ffbd >label setNam  $FFD8 >label BSAVE  $FFD5 >label BLOAD   Label slPars                              setup jsr (16 rom C)                     $80 # lda setMsg jsr 0 # lda status sta  N lda sec 8 # sbc  (drv    sta                 CC ?[ dex ]? (drv 1+ stx           N ldx     N  1+ ldy 1 #  lda setlfs jsr  N 4 + ldx N 5 + ldy N 2+ lda setnam jsr  N 6 + ldx N 7 + ldy                      rts end-code                            Label slErr \ AR=Kernalfehler             CC ?[ 0 # lda ]? pha                     status lda $bf # and                     (16 ram C) push jmp end-code            -->                                                                                                                        FORTH-GESELLSCHAFT (c) bp/ks/re/we/clv  \ ..cSave cLoad               clv10oct87                                          Code cSave ( f t+1 Name Nlen dev--err)    5 # lda    SLPars jsr                    N 8 + # lda bsave jsr                    slErr jmp end-code                                                               Code cLoad ( f Name Nlen dev--t+1 err)    4 # lda    SLPars jsr                    0 # lda     bload jsr                    php pha tya pha txa pha 0 # ldy          SP 2dec pla SP )y sta iny pla SP )Y sta  pla plp slErr jmp  end-code                                                      -->                                                                               \\ moegliche Fehler                       AR CF ST                  Basic  Forth   xx  L 00 kein Fehler         0     0     00  H 00 stop-taste         1e    1e     00  L 60 end-of-tape        04    00     00  L 10 load/verify-error  1d/1c 1d     00  L 60 Pruefsummenfehler  1d    1d    0-8  H 00 Kernal-Fehler      0-8  0-8    FORTH-GESELLSCHAFT (c) bp/ks/re/we/clv  \ ..cSave cLoad Luxus         clv10oct87                                                                                   Code .err ( err#-err# ) \ druckt Meldung  SP x) lda 0>=                            ?[ (16 tax dex rom $8654 jsr C)             (64 .A asl tax rom                       $a326 ,x lda $24 sta                     $a327 ,x lda $25 sta dey C) dey          [[ iny $24 )y lda php  $7f # and            $ffd2 jsr plp 0< ?]                   (16 ram C) (64 ram C)                  ]? xyNext jmp end-code                                                                                                   : derr?  ( err# -- flag)                  dup IF cr dup u. .err ." error" THEN     dup $ff and 5 = not                      (drv @ -1 > and                          IF derror? or THEN                       (drv @ 0 max (drv ! ;                                                            \\ zur Benutzung nach CSAVE und CLOAD.      Die letzte Zeile ist nur fuer            Kompatibilitaet zur alten Version.   \ TapeVersion:LoadScreen      clv12oct87                                          Onlyforth                                                                         \needs Code  .( ?! Code !?)   quit                                                              5 +load    \ Ramdisk                    -3 +load    \ csave/load               1  3 +thru    \ Tape                  (16 $10 +load C) \ superTape                   4 +load    \ savesys                                                Onlyforth                                Variable autoload   autoload off                                                  : tapeInit  cr cr ." Tape2.00 "           \if supertape supertape                  ['] ramr/w Is r/w  1 drive               autoload @                               IF autoload off loadramdisk THEN ;                                               save                                     ' tapeInit Is 'restart                   \ restart                                                                        \ store restore               clv24jul87                                          \ wie push pull abort"                                                            | Create restore 0  ] r> r> ! ;                                                   : store ( addr -- )                       r> swap dup >r @ >r  restore >r >r  ;    restrict                                \ rstack:   restore date adresse ....                                             | : back \ -- \ rewinds rstack            r> BEGIN rdepth WHILE                         r> restore =                             IF r> r> ! THEN REPEAT >r ;                                                 : (restore"    "lit swap IF                 >r clearstack r> back                    errorhandler perform                   exit THEN  drop ;  restrict                                                                                               : restore"  compile (restore" ," ;        immediate  restrict                                                             \ tape-interface              clv01aug87                                          \needs cload   .( ?! cload ?!)   quit    \needs restore .( ?! restore ?!) quit                                             Variable device      0 device !          : commodore     1 device ! ; \ Geraet..  : floppy        8 device ! ;                                                                                               : bload  ( [from name count -- ]to)        device @ cload derr? restore" load" ;                                           : bsave  ( [from ]to name count--)         device @ csave derr? restore" save" ;                                           : n" ( -- adr count) Ascii " parse ;                                                                                                                                                                                                                                                                                                                                            \ Ramdisk TapeInterface       clv29jul87                                          Onlyforth Ramdisk also                                                            : saveRamDisk                              rd behind id count bsave ;                                                                                               : loadRamDisk                             rd? 0=                                   IF range memtop  rdnew rd THEN           " RD." count bload drop ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ \if savesystem"             clv01aug87                                          \needs restore" .( ?! restore" ?!) quit                                           Onlyforth                                                                         : \if name find 0=                        IF [compile] \ THEN drop ; immediate                                             : savesystem \ -- Name muss folgen        \ Forth-Kernal a la boot:                  scr store 1 scr ! r#  store 0 r# !     \ Editor  a la boot                       \if Editor  [ Editor ]                   \if Editor stamp$ store stamp$ off       \if Editor (pad   store (pad   off        save                                   \ Supertape? dann andere Routine          \if supertape device @ 7 =               \if supertape IF stSavSys exit THEN     \ nun geht's los                           origin $17 - here n" bsave ;                                                                                                                                    \ RD: loadscreen              clv01aug87                                          Onlyforth                                                                         (16 $fd00 C) (64 $c000 C)                Constant memtop                                                                   Vocabulary Ramdisk                       Ramdisk also definitions                                                                1   9 +thru                                                                 Onlyforth                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ RD: Grundlagen              clv01aug87                                          Variable (rd     (rd off                 $31 constant plen                                                                 : adr>   ( adr--ofs) (rd @ -          ;  : >adr   ( ofs--adr) (rd @ +          ;  : adr@   ( ofs--adr) >adr @ >adr      ;  : rd?    ( -- adr flag )                    (rd @ dup   dup   @ plen =     and ;  : rd     ( -- adr)                          rd? 0= abort" no Ramdisk" ;                                                    | : take   ( adr--   ) adr> 2 >adr !  ;                                           : adr    ( --adr   ) 2   adr@         ;  : data   ( --adr   ) adr 4 +          ;                                           | : end    ( --adr   ) 4   adr@       ;  : behind ( --adr   ) end 4 +          ;  | : end+   ( len--   ) 4   >adr +!    ;                                           : blk#   ( --adr   ) 8   >adr         ;  : id     ( --adr   ) $10 >adr         ;                                          \ RD: new delete len@ len!    clv01aug87                                          | : ?full      end 6 adr@ b/blk - 4 -                 u> abort" Ramdisk full" ;                                            | : new ( --)  end take ?full ;                                                   | : len! ( len--) \ neuen Block beenden   ?dup 0= ?exit                            blk# @   end 2+ !  4 + dup end !         end+  end off ;                                                                  | : len@ ( --len) \ Laenge ermitteln      adr @ dup 0= ?exit 4 - ;                                                                                                  : delete  ( --)    \ Loeschen             adr dup @ under + adr behind over -      cmove                                    negate end+ ;                                                                                                                                                                                                                                       \ RD: search binary           clv01aug87                                          : search ( blk --) \ setzt akt. Block     rd BEGIN dup @ + dup @ WHILE              ( blk adr ) 2dup 2+ @ = UNTIL           take  blk# ! ;                                                                   | : notRD? ( blk--flag) blk/drv u< ;                                                                                                                                                                                                                                                                                                                                             Onlyforth Ramdisk also                                                            : binary ( blk--blk) \ no ComPand         dup offset @ + notRD? ?exit              dup block drop update                    delete new b/blk len! ;                                                                                                                                           \ RD: cbm>7bit 7bit>cbm       clv01aug87                                          Label cbm>7b \ AR=char -- 7bitChar        $80 # cmp 0< ?[ rts ]?                   $c0 # cmp CS ?[ $e0  # cmp CC ?[               $a0 # adc rts ]? ]?                $1f # and       rts end-code            Label 7b>cbm \ AR=7bitChar -- char        $60 # cmp CC ?[ rts ]?                   $a0 # sbc rts end-code                                                           Code c>7 sp x) lda cbm>7b jsr putA jmp   Code 7>c sp x) lda 7b>cbm jsr putA jmp   end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ RD: cp1 cp2                 clv01aug87                                          Label cp1 ( from to count--tocount)       3 # lda setup jsr N 2+ lda N 6 + sta     N 3+ lda N 7 + sta dey  $7f # ldx        N lda 0=                                 ?[ N 1+ lda 0= ?[ pla pla 0 # lda          push0a jmp ]? ][ N 1+ inc ]? rts                                               Label cp2                                 sec N 2+ lda N 6 + sbc pha                   N 3+ lda N 7 + sbc push jmp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ RD: expand compress         clv01aug87                                          Code expand  cp1  jsr                     [[ [[ N 4 + )y lda 0<                     ?[ $7f # and tay tax bl # lda             [[ N 2+ )y sta dey 0< ?] iny             sec txa                                  N 2+ adc N 2+ sta CS  ?[ N 3+ inc ]?    ][ 7b>cbm jsr N 2+ )y sta N 2+ winc ]?   N 4 + winc  N dec 0= ?] N 1+ dec 0= ?]   cp2 jmp end-code                                                                Code compress  cp1 jsr                    [[ [[ N 4 + )y lda bl # cmp 0=            ?[ inx 0=                                 ?[ dex txa  N 2+ )y sta N 2+ winc         $80 # ldx ]?                            ][ $80 # cpx 0>=                          ?[ pha txa N 2+ )y sta N 2+ winc          $7f # ldx pla ]?                        cbm>7b jsr N 2+ )y sta N 2+ winc ]?     N 4 + winc N dec 0= ?] N 1+ dec 0= ?]  $80 # cpx 0>=                            ?[ txa        N 2+ )y sta N 2+ winc ]?   cp2 jmp end-code                       \ RD: ramR/W                  clv01aug87                                          | : endwrite ( compLen--)                 data under + ( [from ]to )               BEGIN 1- dup c@ $7f u> WHILE               2dup u> UNTIL 1+ swap - len! ;                                                 | : endread  ( toAdr expLen--)            under + b/blk rot - bl fill ;                                                    : ramR/W ( adr blk file R/NotW -- error)  2 pick notRD?                            IF 1541r/w                               ELSE swap abort" no file"                 swap search len@ b/blk = ( adr r? b?)    IF   0= IF data ELSE data swap THEN              b/blk cmove                      ELSE 0= IF   delete new data b/blk                    compress endwrite                   ELSE dup data swap len@                       expand endread                                                      THEN THEN false THEN ;                                                                                                   \ RD: id rduse/del/new        clv01aug87                                          : .rd  ( --)     (rd @ u. rd drop          end u. 6 adr@ u. id count type ;                                                : id! ( adr count--)                       $20 id c! id count bl fill               $1a umin id 3 + place                    " RD." count id 1+ swap cmove ;                                                 : id" Ascii " parse id! ; \ Name" folgt                                           : rduse ( from --) (rd ! ;               : rddel  ( --)                             rd @ dup 2 >adr ! 4 >adr ! end off ;   | : range ( adr--adr)                      limit umax memtop umin ;               : rdnew ( from to--)                       range swap range swap                    2dup $500 - u> abort" range!"            over plen over ! rduse                   swap - 6 >adr !                          rddel 0 0 id! ;                                                                                                         \ RD: rdcheck                 clv01aug87                                          | : ?error IF ." error " THEN ;                                                   : rdcheck                                 .rd                                      rd BEGIN                                  dup @   dup 0 b/blk 5 + uwithin                                    not ?error     +       dup cr u.                        dup @   dup 3 u.r space                  WHILE   dup 2+ @ blk/drv u/mod                   1 u.r ." :" 2 u.r                        dup 4 + &26 type                         stop? ?exit                      REPEAT  end -                 ?error ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \ ST:Supertape LoadScreen     clv01aug87                                          (64 .( nix fuer C64!! ) quit C)                                                   \needs Code .( ??! Code !??) quit                                                 Assembler                                \needs rom  .( ??! rom  !??) quit        Onlyforth                                                                            1  $12 +thru \ supertape laden                                                                                          \\ Supertape wird von der Zeitschrift       c't fuer alle gaengigen Rechner          verbreitet.                                Wir danken dem Verlag fuer die         freundliche Genehmigung, es fuer         unsere Zwecke anpassen und               weiterverbreiten zu duerfen                                                                                                                                                                                                                       \ ST:Labels..                 clv16jun87                                          \ ------ hardware-Adressen -----------   $0001 >Label pCass                       $ff02 >Label pTimerB                     $ff09 >Label pTimerBCtrl                 $ff3f >Label pRamOn                      $ff3e >Label pRamOff                                                              \ ------ System-Vektoren -------------   $0330 >Label vSave                       $032e >Label vLoad                                                                \ --- Eingabe-Parameter Load/Save-----   $ae >Label zGeraeteNr                    $ad >Label zSekadd                       $af >Label zFilenameZ                    $ab >Label zFileNameC                    $b4 >Label zBasLadeAdd                   $b2 >Label zIOStartZ                     $9d >Label zProgEndeZ                                                             \ --- Ausgabe-Parameter von Load/Save -- $90 >Label zStatus                                                               \ ST:..Labels                 clv16jun87                                          \ ------ benutzte System-Routinen -----  $e38d >Label xCassMotorOn                $e3b0 >Label xCassMotorOff               $e364 >Label xCassPrtOn                  $e378 >Label xCassPrtOff                 $f050 >Label xLoad                       $f1a4 >Label xSave                       $f189 >Label xMsgLoadVerify              $e31b >Label xPressplay                  $e319 >Label xPressRec                   $ebca >Label xFoundFile                  $f160 >Label xSearching                  $ffd2 >Label kOutput                                                              \ ------ benutzte Zeropage-Adressen----                                           $5f >Label zAnfangZ                      $61 >Label zEndeZ                        $93 >Label zVerifyFlag                   $59 >Label ZBlockArt                     $58 >Label zBit                          $57 >Label zByte                         $ff >Label zTmp                         \ ST:..Labels                 clv16jun87                                                                                   $d8 >Label zReservAA                     $5d >Label zCheckSum                     $63 >Label zPruefSummeB                  $da >Label zTmpSP                                                                                                          \ --- sonstige Systemadressen -------    $07c8          >Label sTime              $0332  dup     >Label sCassBuffer        $19 + $100 mod >Label cCassBufferEnd                                              \ --------- Konstanten --------------    $07 >Label cGeraetST                     $2a >Label cHeaderMark                   $c5 >Label cDatenMark                    $4f >Label chsl                          $b5 >Label clsl                          $78 >Label chssh    $34 >Label chssl     $ff >Label clssh    $78 >Label clssl     $16 >Label cSyncByte                     $0b >Label cSyncBytesLoad                $40 >Label cSyncByteZahl                \ ST:verschiedenes            clv28jul87                                          Label btlBeg                             Label puffinit \ LadeZeiger auf Puffer    sCassbuffer $100 u/mod                   # lda    zAnfangZ 1+ sta zEndeZ 1+ sta   # lda    zAnfangZ    sta                 cCassbufferEnd # lda     zEndeZ    sta   rts end-code                                                                     Label timerBStart                         sTime lda          pTimerB      sta      0   #  lda         pTimerB   1+ sta      $10 #  lda         pTimerBCtrl  sta      rts end-code                                                                     Label delayMotor \ Hochlauf-Verzoegerung  0 # ldx 0 # ldy                          [[ [[ dex 0= ?] dey 0= ?]                rts end-code                                                                                                                                                                                                                                        \ ST:stEnde etc.              clv23jul87                                          Label stEnde        0 # lda  $2c c,      Label loadFehler  $1d # lda  $2c c,      Label eot         $04 # lda  $2c c,      Label verFehler   $1c # lda  $2c c,      Label brkFehler   $1e # lda               pRamOff sta  pha                         xCassMotorOff jsr  xCassPrtOff jsr       zTmpSP ldx   pla  txs                    zAnfangZ ldx  zAnfangZ 1+ ldy            01 # cmp cli rts end-code                                                                                                 \\  cbm: stop: ar=0  cf=1                      normal ar=0  cf=0  st=0                    eot                 $80           load/vererr                $10              pruefsum                $60                                      ...          kernal-fehler ar=0..8 cf=1                                                         s.ROM:$a803                                                                                                              \ ST:bitLesen                 clv18jun87                                          Label bitLesen \ akt.Byte in AR zurueck   $10 # lda [[ ptimerBctrl bit 0<> ?]      pCass lda  $10 # and  zBit cmp           0<> ?[ clc ]?        zBit sta            zByte ror zByte lda                      0< ?[ zCheckSum wInc ]?                  [[ pCass lda $10 # and  zBit cmp 0<> ?]  zBit sta timerBStart jsr                 zByte lda rts end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ ST:stRead..                 clv05aug87                                          Label stRead \ liest einen Block          zBlockArt sta  0 # ldx                  Label syncron                             [[ bitLesen jsr cSyncByte # cmp 0= ?]    cSyncBytesLoad # ldx                     [[ $08 # ldy                                [[ bitLesen jsr dey 0= ?]                cSyncByte # cmp         syncron bne      dex 0= ?]                             [[ $08 # ldy                                [[ bitLesen jsr dey 0= ?]                cSyncByte # cmp 0<> ?]                zBlockArt cmp 0<>                        ?[ cDatenMark # cmp        syncron beq   $10 # lda zStatus sta loadFehler jmp ]?  0 # lda zCheckSum sta zCheckSum 1+ sta   $08 # ldy                                   [[ bitLesen jsr dey 0= ?] zTmp sta                                                                                                                                                                                                               \ ST:..stRead                 clv28jul87                                           [[ [[                                     zCheckSum    lda  zPruefSummeB    sta    zCheckSum 1+ lda  zPruefSummeB 1+ sta    bitLesen jsr      bitLesen jsr           zVerifyFlag lda 0=                       ?[ zTmp lda   zAnfangZ )Y sta ]?         bitLesen jsr      bitLesen jsr           zTmp lda      zAnfangZ )Y cmp            0<> ?[ inx ]?                            bitLesen jsr      bitLesen jsr           zAnfangZ wInc                            bitLesen jsr      bitLesen jsr           zTmp sta                                zAnfangZ 1+ lda  zEndeZ 1+ cmp 0= ?]     zAnfangZ Æ#¦+s#+Ó6kƒÖöÖþ\ ST:..stRead                 clv05aug87                                           zTmp lda ZPruefSummeB cmp 0<> ?[        Label SFehler zStatus lda  $60 # ora              zStatus sta loadFehler jmp ]?    $08 # ldy                                   [[ BitLesen Jsr dey 0= ?]             zPruefSummeB 1+ cmp        SFehler bne   0 # cpx  0<> ?[ $10 # lda zStatus sta                          verFehler jmp ]?  Label ldRTS rts end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \ ST:stLoad..                 clv23jul87                                          Label stLoad                              zVerifyFlag sta  0 # lda zStatus sta     zGeraeteNr  lda  cGeraetST # cmp 0<>     ?[ xLoad jmp ]? \ CBM-Routine           Label loadNext                            tsx  zTmpSP stx                          xPressplay jsr ldRTS bcs                 sei     zVerifyFlag lda pha              0 # lda zVerifyFlag sta                  xSearching jsr                          Label ldWrongFile                         xCassMotorOn jsr delayMotor jsr          xCassPrtOn   jsr puffInit   jsr          clsl # lda   sTime sta                   cHeaderMark # lda  stRead jsr            $63 # ldy  xFoundFile jsr                0 # ldy [[ sCassBuffer ,Y lda               kOutput jsr  iny  $10 # cpy  0= ?]    $ff # ldy                                                                                                                                                                                                  \ ST:..stLoad                 clv23jul87                                                                                   Label ldComp                              [[ iny zFileNameC cpy 0<>                 ?[[ pRamOn sta zFilenameZ )Y lda         pRamOff sta                              sCassBuffer ,Y cmp         ldComp beq    Ascii ?      # cmp         ldComp beq    sCassBuffer $10 + lda  $02 # and 0<>     ?[ $80 # lda zStatus sta eot jmp ]?      xCassPrtOff jsr       ldWrongFile jmp   ]]? pla  zVerifyFlag sta                 xMsgLoadVerify jsr                       zBasLadeAdd    lda  zAnfangZ    sta      zBasLadeAdd 1+ lda  zAnfangZ 1+ sta      zSekAdd lda 0<>                          ?[ sCassBuffer $11 + lda zAnfangZ   sta    sCassBuffer $12 + lda zAnfangZ 1+ sta  ]?                                       clc sCassBuffer $13 + lda                zAnfangZ    adc zEndeZ    sta            sCassBuffer $14 +  lda                   zAnfangZ 1+ adc zEndeZ 1+ sta                                                   \ ST:..stLoad                 clv20nov87                                                                                    chsl # lda    sTime sta                  sCassBuffer $10 + lda 0>=                ?[ clsl # lda sTime sta ]?               pRamOn sta  cDatenMark # lda stRead jsr  stEnde jmp end-code                                                              Label loadsys \ laedt und startet         loadnext jsr CS ?[ brk ]?                loadnext jsr CS ?[ brk ]?                origin 8 - jmp \ Forth-Cold             Label btlEnd                             base @ hex                               Create g----    7 allot                  loadsys 0 <# #s Ascii g hold #cr hold #> g---- place                              base !                                   : >lower ( str--) count bounds            DO I c@ $7f and I c! LOOP ;                                                      g---- >lower    forget >lower                                                                                             \ ST:wByte w4bits             clv16jun87                                          Label wByte here 3 + Jsr \ Byte schreib. Label w4bits             \ obere 4 Bits   $04 # ldy                                [[ zByte lsr CS                             ?[ zReservAA 1+ lda  sTime sta ]?        $10 # lda [[ pTimerBCtrl bit 0<> ?]      timerBStart jsr                          pCass lda  $02 # eor pCass sta           CC ?[ $10 # lda                             [[ pTimerBCtrl bit 0<> ?]                timerBStart jsr                          pCass lda  $02 # eor pCass sta        ][ zCheckSum    lda 0 # adc                 zCheckSum    sta                         zCheckSum 1+ lda 0 # adc                 zCheckSum 1+ sta                         zReservAA lda sTime sta ]?            dey 0= ?] rts  end-code                                                                                                                                                                                                                          \ ST:stWrite                  clv18jun87                                          Label stWrite \ schreibt einen Block      pha cSyncByteZahl # ldx                  [[ cSyncByte # lda  zByte sta               wByte Jsr dex 0= ?]                   pla  zbyte sta  wByte Jsr                0 # ldy zCheckSum sty zCheckSum 1+ sty   [[ [[                                     zAnfangZ )Y lda  zByte sta w4bits jsr    zAnfangZ wInc              w4bits jsr    zAnfangZ    lda   zEndeZ    cmp 0= ?]    zAnfangZ 1+ lda   zEndeZ 1+ cmp 0= ?]   zCheckSum lda  zCheckSum 1+ ldx          zByte sta        wByte jsr               txa   zByte sta  wByte jsr               wByte jmp end-code                                                                                                                                                                                                                                                                                                                                                             \ ST:saveName                 clv26jul87                                          Label saveName \ prueft nix               bl # lda  $0f # ldy                      [[ sCassBuffer ,Y sta  dey 0= ?]         zFileNameC ldy ram                       [[ dey 0>= ?[[ zFileNameZ )Y lda            sCassBuffer ,Y sta ]]? rom           Label rsRTS rts end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ ST:stSave..                 clv16jun87                                          Label stSave                              zGeraeteNr lda cGeraetST # cmp 0<>       ?[ sec $0e # and 0= ?[ clc ]?                                       xSave jmp ]?  tsx  zTmpSP stx                          saveName jsr                             clc  xPressRec  jsr          rsRTS bcs   sei  xCassPrtOn jsr xCassMotorOn jsr     delayMotor jsr                           zSekAdd lda  sCassbuffer &16 + sta       zIOStartZ    lda sCassBuffer &17 + sta   zIOStartZ 1+ lda sCassBuffer &18 + sta   sec zProgEndeZ lda  zIOStartZ    sbc     sCassBuffer &19 + sta                    zProgEndeZ 1+ lda   zIOStartZ 1+ sbc     sCassBuffer &20 + sta                    0 # lda sCassBuffer &21 +                dup sta 1+ dup sta 1+ dup sta 1+ sta     pTimerB 1+ sta                           sCassBuffer $100 u/mod                   # lda zAnfangZ 1+ sta  zEndeZ 1+ sta     # lda zAnfangZ    sta                    cCassBufferEnd # lda   zEndeZ    sta   \ ST:..stSave                 clv16jun87                                                                                    clssh # lda  zReservAA 1+ sta            clssl # lda  zReservAA    sta            pTimerB sta                              $10 # lda  pTimerBCtrl sta               cHeaderMark # lda  stWrite jsr           delayMotor jsr                           zSekadd bit 0<                           ?[ chssh # lda  zReservAA 1+ sta            chssl # lda  zReservAA    sta            pTimerB sta ]?                        zIOStartZ     lda  zAnfangZ    sta       zIOStartZ  1+ lda  zAnfangZ 1+ sta       zProgEndeZ    lda  zEndeZ      sta       zProgEndeZ 1+ lda  zEndeZ   1+ sta       pRamOn sta cDatenMark # lda stWrite jsr  delayMotor jsr stEnde jmp end-code                                                                                                                                                                                                                                                           \ ST:supertape savebooter     clv10oct87                                          : supertape  \ --                         7 device !                               stLoad vLoad !  stSave vSave !           ." ST2.20 " ;                                                                    | : (n" >in store n" ;                                                            : btl ( --[from ]to )                     [ BtlBeg ] Literal [ BtlEnd ] Literal ;                                          | : btlName ( --adr count)                pad $16 bl fill                          (n" $10 umin pad     swap cmove          g---- count pad $a + swap cmove          pad $10 ;                                                                        : stSavSys ( --)  \ Name" folgt            device store 1 device !                  btl btlName               bsave          7 device !                               origin $17 - btl drop (n" bsave          btl nip here           n" bsave ;                                              \ Loadscreen for Decompiler    20oct87re \ nach F83 by Henry Laxen / Mike Perry                                            \needs Tools  Vocabulary Tools                                                    .( Decompiler loading...)                                                         Onlyforth                                Tools also definitions                                                            \needs dis     ' drop | Alias dis                  \ Disassemble if possible                                               &1 &9 +thru                                                                       \\                                                                                clear                                                                                                                                                                                                                                                                                                                                  \ case defining words        20aug85mawe                                          | : case:  ( n -)                         Create , 0 ]                             Does> 2+ swap 2* + perform ;                                                     | : associative:                          Create ,   ( n -)                        Does>      ( n - index)                  dup @ -rot dup @ 0                         DO 2+ 2dup @ =                             IF 2drop drop I 0 0 LEAVE THEN         LOOP 2drop ;                                                                                                            Defer (see                               | Variable maxbranch                     | Variable thenbranch                                                                                                                                                                                                                                                                                                                  \ decompile each type of word 29nov85re                                           | : .word   ( IP - IP')                   dup @ >name .name 2+ ;                                                           | : .lit    ( IP - IP')                   .word dup @ . 2+ ;                                                               | : .clit   ( IP - IP')                   .word dup c@ . 1+ ;                                                              | : .string ( IP - IP')                   cr .word count 2dup type ascii " emit    space + ;                                                                        | : .do  ( IP - IP')   ." DO " 4 + ;                                              | : .loop  ( IP - IP')   ." LOOP " 4 + ;                                          | : .exit    ( IP - IP' f)                dup maxbranch @ u< IF  .word exit  THEN  dup @ [ Forth ] ['] unnest =             IF  ." ; "  ELSE  .word ." ; -2 allot "  THEN  0= ;                                                                      \ branch, ?branch             29nov85re                                           | : .to                                   ." back to " .word drop ;                                                        | : .branch ( IP - IP')                   2+ dup @ 2dup +  swap 0<                 IF   cr ." REPEAT to " .exit               0<> swap 2+  and  exit                 THEN cr ." ELSE " dup thenbranch !       dup maxbranch @ u>                       IF  maxbranch !  ELSE  drop  THEN 2+ ;                                           | : .?branch  ( IP - IP')                 2+ dup @ 2dup +                          swap 0<                                  IF cr ." UNTIL " .to 2+ exit THEN        cr dup 4 - @ [ ' branch ] literal =      over 2-  @ 0< and                        IF   ." WHILE "                          ELSE ." IF "  dup thenbranch !           THEN  dup maxbranch @ u>                    IF maxbranch ! ELSE drop THEN  2+ ;                                                                                   \ decompile does> ;code ;      20oct87re                                          | : does?    ( IP - IP' f)                dup 3 + swap                             dup c@ $4C  =  swap      \ jmp-opcode    1+ @  ['] Forth @ 1+ @ = \ (dodoes>      and ;                                                                            | : .(;code  ( IP - IP' f)                 2+ does?                                  IF cr ." Does> "                         ELSE  ." ;Code " 3 - dis 0 THEN ;                                              | : .compile  ( IP -- IP' )                .word .word ;                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ classify each word           20oct87re                                          &18 associative: execution-class         Forth                                    ' lit ,     ' clit ,     ' ?branch ,     ' branch ,  ' (DO ,      ' (." ,         ' (abort" , ' Does> 4 + @ , \ (;code     ' exit ,    ' abort ,    ' quit ,        ' 'quit ,   ' (quit ,    ' unnest ,      ' (" ,      ' (?DO ,     ' (LOOP ,       ' compile ,                                                                       &19 case: .execution-class               .lit        .clit        .?branch        .branch     .do          .string         .string     .(;code                      .exit       .exit        .exit           .exit       .exit        .exit           .string     .do          .loop           .compile    .word    ;                                                                                                                                                                                                                               \ decompile a :-definition   20aug85mawe                                          : .pfa  ( cfa -)                          >body                                    BEGIN ?cr dup                              dup thenbranch @ =                       IF ." THEN " ?cr THEN                    @ execution-class .execution-class       dup 0= stop? or UNTIL                  drop ;                                                                           : .immediate  ( cfa -)                    >name c@ dup                             ?cr $40 and IF ." Immediate " THEN       ?cr $80 and IF ." restrict" THEN ;                                               : .constant   ( cfa -)                    dup >body @ . ." Constant "              >name .name ;                                                                    : .variable   ( cfa -)                    dup >body . ." Variable "                dup >name .name                          cr ." Value = "  >body @ . ;                                                    \ display category of word     20oct87re                                          : .:      ( cfa -)                        ." : " dup >name .name cr .pfa ;                                                 : .does>  ( cfa -)                        cr ." Does> " 2- .pfa ;                                                          : .user-variable  ( cfa -)                dup >body c@ . ." User-Variable "        dup >name .name                          cr ." Value = "  execute @ . ;                                                   : .defer  ( cfa -)                        ." deferred " dup >name .name            ." Is " >body @ (see ;                                                           : .other  ( cfa -)                        dup >name .name                          dup @ over >body =                        IF ." is Code" @ dis exit THEN          dup @ does? IF .does> drop exit THEN     drop ." maybe Code" @ dis ;                                                                                              \ Classify a word              22jul85we                                          5 associative: definition-class          ' quit @ ,        ' 0 @ ,                ' scr @ ,         ' base @ ,             ' 'cold @ ,                                                                       6 case: .definition-class                .:                .constant              .variable         .user-variable         .defer            .other  ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ Top level of Decompiler    20aug85mawe                                          : ((see    ( cfa -)                       maxbranch off  thenbranch off            cr dup dup @                             definition-class .definition-class       .immediate ;                                                                     ' ((see Is (see                                                                   Forth definitions                                                                 : see   ' (see ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \ Commodore hole Screens       20oct87re                                          Onlyforth                                                                         : <init   0 $DD03 c! ;                                                            : get  ( -- 8b)                           BEGIN  $DD0D c@ $10 and  UNTIL           $DD01 c@ dup $DD01 c! ;                                                          : <sync  ( --)                            <init  BEGIN  get $55 =  UNTIL           BEGIN  get dup $55 =                     WHILE  drop  REPEAT  abort" SyncErr" ;                                           : sum  ( oldsum n -- newsum n)            swap over + swap ;                                                               : check  ( sum.int  8b.sum.read --)       swap $FF and - abort" ChSumError" ;                                              -->                                                                                                                                                                \ Commodore hole Screens       20oct87re                                          : download  ( n --)                       <sync  0 swap buffer b/blk bounds        DO  get  sum  I c!  LOOP                 get check update ;                                                               : downthru  ( start count --)             bounds DO  I download  LOOP ;                                                    -->                                                                               \\ sync needs: xx $55 $55 00 data                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \ Commodore sendscreens        20oct87re                                          : >init  $FF $DD03 c! ;                                                           : put ( 8b -)                             $DD01 c!  BEGIN  stop?                    IF  <init true abort" terminated" THEN   $DD0D c@ $10 and  UNTIL ;                                                       : >sync  ( --)                            >init $10 0 DO $55 put  LOOP  0 put ;                                            : upload  ( n --)                         >sync  0 swap  block b/blk bounds        DO  I c@ sum  put  LOOP                  $FF and  put  <init  ;                                                           : upthru  ( from to -- )                  1+ swap DO  I . cr  I upload  LOOP ;                                                                                                                                                                                                                                                         \ Graphic Load-Screen          20oct87re                                          (16 .( C64 Only ) \\ C)                                                           Onlyforth                                                                         \needs Code         .( Assembler??!) \\                                           \needs lbyte         1 +load                                                      \needs 100u/       &26 +load                                                      Vocabulary graphic                                                                ' graphic | Alias Graphics                                                        Graphics also definitions                                                           2 &15 +thru  \ hires graphic           &16 &20 +thru  \ sprites                 &21 &23 +thru  \ turtle graphic                                                   Onlyforth                                                                                                                 \ >byte hbyte lbyte            20oct87re                                          Code >byte   ( 16b - 8bl 8bh)             SP )Y lda pha txa SP )Y sta SP 2dec      txa SP )Y sta pla Puta jmp   end-code                                            : hbyte >byte nip ;                      : lbyte >byte drop ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             \ Gr Constanten                20oct87re                                          | $0288 Constant scrpage                 | $E000 Constant bitmap                  | $D800 Constant charset                 | $C400 Constant colram                  | $C000 Constant vidram                  \ $C800 Constant sprbuf                                                              bitmap hbyte $40 /mod  3 swap -       | Constant bank                             $20 / 8 *                                colram  hbyte $3F and 4 / $10 * or    | Constant bmoffs                           vidram  hbyte $3F and 4 / $10 *          charset hbyte $3F and 4 / or          | Constant tmoffs                                                                 $0314 | Constant irqvec                  $EA31 >label oldirq                      $EA81 >label irqend                      $FF6E >label settimer                                                                                                                                              \ Gr movecharset clrscreen     20oct87re                                          | Code movecharset                        sei  $32 # lda  1 sta   dey  8 # ldx     N sty  N 2+ sty  $D8 # lda  N 1+ sta     charset hbyte # lda  N 3 + sta            [[                                        [[  N )Y lda  N 2+ )Y sta  iny  0= ?]   N 1+ inc  N 3 + inc  dex  0= ?]         $36 # lda   1 sta  cli  iny              Next jmp  end-code                                                                                                        : clrscreen ( -- ) bitmap &8000 erase ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \ Gr Variablen (text (hires    20oct87re                                          | Variable cbmkey                        | Variable switchflag                    | Variable textborder                    | Variable hiresborder                   | Variable switchline                    | Variable chflag                                                                 Label (text                               $1B # lda  $D011 sta                     tmoffs # lda  $D018 sta                  textborder lda  $D020 sta  rts                                                   Label (hires                              $3B # lda  $D011 sta                     bmoffs # lda  $D018 sta                  hiresborder lda  $D020 sta  rts                                                                                                                                                                                                                                                                                                       \ Gr rasterirq graphicirq      20oct87re                                          Label windowhome                          switchline lda sec $30 # sbc             .A lsr .A lsr .A lsr  sec 1 # sbc         $D6 cmp CC ?[ rts ]?                     tax inx 2 # ldy $CC sty $CD sty          $CE lda $D3 ldy $D1 )Y sta               0 # ldy $CF sty clc $FFF0 jsr            0 # ldy $D1 )y lda $CE sta $CC sty       rts                                                                             Label graphicirq                         $28D lda  2 # and 0= ?[ oldirq jmp ]?    [[ $FF9F jsr $28D lda 0= ?] cbmkey ) jmp                                          Label rasterirq                           $D019 lda $D019 sta                      $15 # ldx [[ dex 0= ?] N lda ( Blind!!)  chflag lda  1 # eor chflag sta tax       0= ?[ (hires jsr ][ (text jsr ]?         switchline ,x lda $D012 sta              windowhome jsr                           $DC0D lda  1 # and graphicirq bne        irqend jmp                             \ Gr IRQ-Behandlung (window    20oct87re                                          Label setirq                              sei graphicirq >byte                     # lda irqvec 1+ sta    # lda irqvec sta  $F0 # lda $D01A sta $81 # lda $DC0D sta  cli rts                                                                          | Code resetirq                           sei oldirq >byte                         # lda irqvec 1+ sta    # lda irqvec sta  $F0 # lda $D01A sta $81 # lda $DC0D sta  cli Next jmp end-code                                                            Label (window                             rasterirq >byte                          # lda irqvec 1+ sta  # lda irqvec sta    $7F # lda $DC0D sta $F1 # lda $D01A sta  switchflag stx chflag stx                windowhome jmp                                                                                                                                                                                                                                      \ Gr text hires window switch  20oct87re                                          Code text    1 # lda switchflag sta       setirq jsr  (text jsr  Next jmp          end-code                                                                         Code hires   2 # lda switchflag sta       setirq jsr  (hires jsr  Next jmp         end-code                                                                         | Code setwindow  ( row -)                sei (window jsr cli xyNext jmp           end-code                                                                         : window   ( row -)                       8 * $30 + switchline c! setwindow ;                                              Label switch    switch cbmkey !           switchflag ldx                                   0= ?[ inx switchflag stx             setirq jsr (text  jsr oldirq jmp ]?  1 # cpx 0= ?[ inx switchflag stx             setirq jsr (hires jsr oldirq jmp ]?  0 # ldx  switchflag stx                  (window jsr  oldirq jmp  end-code      \ Gr graphic forth             20oct87re                                          Forth definitions                                                                 : graphic                                 Graphics movecharset                     $DD00 c@  $FC and  bank or  $DD00 c!     vidram hbyte scrpage c!                  colram c@ hiresborder c!                 $D020 c@ textborder c!                   $10D0 switchline !                       text ;                                                                           : nographic                               Onlyforth resetirq                       $1B $D011 c!  $17 $D018 c! 4 scrpage c!  textborder c@   $D020 c!                 $DD00 c@  3 or  $DD00 c! ;                                                       Graphics definitions                                                                                                                                                                                                                                 \ Gr Colors                    20oct87re                                          0  Constant blk      1 Constant wht      2  Constant red      3 Constant cyn      4  Constant pur      5 Constant grn      6  Constant blu      7 Constant yel      8  Constant ora      9 Constant brn      $A Constant lre     $B Constant gr1      $C Constant gr2     $D Constant lgr      $E Constant lbl     $F Constant gr3                                               : border      ( color -)                  dup textborder c! $D020 c! ;                                                     : screen      ( color -)   $D021 c! ;                                             : colors      ( bkgrnd  foregrnd -)       over hiresborder c!                      $10 *  or  colram $03F8  rot fill ;                                              : background  ( color -)                  colram c@ $10 /  colors ;                                                        : pencolor    ( color -)                  colram c@ $F and swap  colors ;        \ Gr Bittab Labels             20oct87re                                          Label bittab                              $80 c, $40 c, $20 c, $10 c,              $08 c, $04 c, $02 c, $01 c,                                                      | : >laballot  ( adr n - adr+n)           over >label + ;                                                                  $60 Constant pointy  $62 Constant pointx                                          Assembler                                                                         N                                         2 >laballot y0      2 >laballot x0       2 >laballot y1      2 >laballot x1       2 >laballot offset  2 >laballot dy       2 >laballot dx      2 >laballot ct       1 >laballot iy      1 >laballot ix       1 >laballot ay      1 >laballot ax       2 >laballot bytnr                       drop                                                                                                                                                               \ Gr (plot compute             20oct87re                                          Label (plot  ( x y -)                     2 # lda  setup jsr      3 # ldx          [[ y0 ,X lda  pointy ,X sta  dex  0< ?]  $C7 # lda sec y0 sbc y0 sta             Label compute  sei  1 dec                 y0 lda  $F8 # and  pha                   bytnr sta  0 # lda  bytnr 1+ sta  clc    bytnr asl  bytnr 1+ rol                  bytnr asl  bytnr 1+ rol                  pla  bytnr adc  bytnr sta                  CS ?[  bytnr 1+ inc  ]?                bytnr asl  bytnr 1+ rol                  bytnr asl  bytnr 1+ rol                  bytnr asl  bytnr 1+ rol                  y0 lda  7 # and  bytnr ora  bytnr sta                                             clc  x0 lda  $F8 # and  bytnr adc        bytnr sta                                  x0 1+ lda  bytnr 1+ adc  bytnr 1+ sta  bitmap hbyte # lda                       bytnr 1+ ora  bytnr 1+ sta               x0 lda  7 # and  tax  bittab ,X lda      0 # ldy  clc rts                       \ Gr plot flip clpx            20oct87re                                          Code plot  ( x y -)                       (plot jsr                                bytnr 1+ ldx bitmap hbyte # cpx          cs ?[ bytnr )Y ora  bytnr )Y sta ]?     Label  romon                              1 inc  cli  xyNext jmp  end-code                                                 Code flip  ( x y -)                       (plot jsr                                bytnr 1+ ldx bitmap hbyte # cpx          cs ?[ bytnr )Y eor  bytnr )Y sta ]?      romon jmp  end-code                                                              Code unplot ( x y -)                      (plot jsr                                bytnr 1+ ldx bitmap hbyte # cpx cs ?[    $FF # eor  bytnr )Y and bytnr )Y sta ]?  romon jmp  end-code                                                              \\ compute schaltet Interrupt aus, die   Worte plot, flip, unplot und line schal- ten ihn wieder ein. Unschoen, aber nicht vermeidbar wegen branch in 'line'.      \ Gr line 1                    20oct87re                                          Code line  ( x1 y1 x0 y0 -)               4 # lda  setup jsr                      Label (drawto                             3 # ldx                                  [[ y0 ,X lda  pointy ,X sta  dex  0< ?]  $C7 # lda sec y1 sbc y1 sta              $C7 # lda sec y0 sbc y0 sta                                                       ix sty  iy sty  ct sty  dey              ax sty  ay sty  ct 1+ sty  dey           x1 lda  x0 cmp  x1 1+ lda  x0 1+ sbc     CC ?[  sec  x0 lda  x1 sbc  dx sta              x0 1+ lda  x1 1+ sbc  dx 1+ sta          ix sty                               ][  x1 lda  x0 sbc  dx sta                   x1 1+ lda  x0 1+ sbc  dx 1+ sta      ]?  y1 lda  y0 cmp                    CC ?[  sec  y0 lda  y1 sbc  dy sta              iy sty                               ][               y0 sbc  dy sta          ]?  dx 1+ lda                                                                                                         \ Gr line 2                    20oct87re                                           0= ?[  dx lda  dy cmp                     CC ?[  dy ldx  dy sta  dx stx                   ix lda  ay sta  iy lda  ax sta           iny  ix sty  iy sty  ]?  ]?      dx 1+ lda  .A lsr  offset 1+ sta         dx lda     .A ror  offset sta           sec  CC ?[  .( Trick!! )                  [[ ix lda                                   0<> ?[ 0>= ?[  x0 winc                              ][  x0 wdec  ]?  ]?           clc  y0 lda  ax adc  y0 sta              clc  offset lda  dy adc  offset sta      CS ?[  offset 1+ inc  ]?   ct winc       dx lda  offset cmp  dx 1+ lda            offset 1+ sbc                            CC ?[  sec  offset lda  dx sbc                  offset sta  offset 1+ lda                dx 1+ sbc  offset 1+ sta                 ay lda                                   0<> ?[  0>= ?[  x0 winc                              ][  x0 wdec ]? ]?            clc  y0 lda  iy adc  y0 sta       ]?                                  \ Gr line 3 flipline           20oct87re                                           swap  ]?  .( des Trickes 2. Teil )       compute jsr                              bytnr 1+ ldx bitmap hbyte # cpx cs ?[   Label mode                                bytnr )Y ora  bytnr )Y sta ]?            1 inc  cli                                  dx lda  ct cmp                           dx 1+ lda  ct 1+ sbc  CC ?]           xyNext jmp  end-code                                                             Code drawto  ( x1 y1 -)                   3 # ldy                                  [[ pointy ,Y lda  y1 ,Y sta  dey  0< ?]  2 # lda setup jsr  (drawto jmp          end-code                                                                          : flipline   ( x1 y1 x0 y0 -)             $51 ( eor )  mode c! line                $11 ( ora )  mode c! ;                                                           \ bad self-modifying code                                                                                                 \ Spr Constanten               20oct87re                                            $C800 Constant sprbuf                  | $D000 Constant sprbase                 | $D010 Constant xposhi                    $D015 Constant sprite                  | $D017 Constant yexpand                   $D01C Constant 3colored                | $D01D Constant xexpand                 | $D025 Constant sprmcol                 | $D027 Constant sprcol                                                           | Create sbittab                          $01 c, $02 c, $04 c, $08 c,              $10 c, $20 c, $40 c, $80 c,                                                                                                                                                                                                                                                                                                                                                                                                                                      \ Spr setbit set formsprite    20oct87re                                          | Code setbit   ( bitnr adr fl  -)        3 # lda  setup jsr  dey                  N 4 + ldx  sbittab ,X lda                N ldx                                    0= ?[ $FF # eor  N 2+ )Y and                ][  N 2+ )Y ora  ]?                   N 2+ )Y sta  xyNext jmp  end-code                                                : set   ( bitnr adr  -)   True  setbit ;                                          : reset ( bitnr adr  -)   False setbit ;                                          : getform  ( adr mem#  -)                 $40 * sprbuf + $40 cmove ;                                                       | : sprite!   ( mem# spr# adr -)          $3F8 + + c! ;                                                                    : formsprite  ( mem# spr# -)              >r sprbuf $3F00 and $40 / + dup          r@ vidram sprite!  r> colram sprite! ;                                                                                   \ Spr move sprpos              20oct87re                                          : xmove   ( x spr#  -)                    2dup 2* sprbase + c!                     xposhi rot $FF > setbit ;                                                        : ymove   ( y spr#  -)                    2* 1+ sprbase + c! ;                                                             : move    ( y x spr#  -)                  under xmove ymove ;                                                                                                       : sprpos  ( spr# - y x)                   dup >r 2* 1+ sprbase + c@                r@ 2* sprbase + c@                       r> sbittab + c@ xposhi c@ and            IF $100 + THEN ;                                                                                                                                                                                                                                                                                                                      \ Sprite Qualities             20oct87re                                          : high    ( spr# -)   yexpand set ;                                               : low     ( spr# -)   yexpand reset ;                                             : wide    ( spr# -)   xexpand set ;                                               : slim    ( spr# -)   xexpand reset ;                                             : big     ( spr# -)   dup high wide ;                                             : small   ( spr# -)   dup low slim ;                                              : behind  ( spr# -)   $D01B set ;                                                 : infront ( spr# -)   $D01B reset ;                                               : colored ( spr# col  -)                  swap sprcol + c! ;                                                                                                                                                                                                                                  \ Spr sprcolors setsprite      20oct87re                                          : sprcolors  ( col# col#  -)              sprmcol 1+ c! sprmcol c! ;                                                       : setsprite  ( mem# y x color spr# -)     under >r colored   r@ move               r@ under formsprite small                r@ 3colored reset  r> sprite set ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     \ Tu heading left right        20oct87re                                          | Variable xpos     | Variable ypos      | Variable deg      | Variable pen                                                | : 100*/  ( n1 n2 n3 - n4)  &100 */ ;                                            : heading     ( - deg)    deg @ ;        : setheading  ( deg -)    deg ! ;                                                 : right  ( deg -)                         deg @ swap - &360 mod deg ! ;                                                    : left   ( deg -)                         deg @ + &360 mod deg ! ;                                                                                                  ' clrscreen  Alias cs                    ' pencolor   Alias pc                    ' background Alias bg                    ' hires      Alias fullscreen            ' window     Alias splitscreen                                                                                                                                     \ Tu positions pen home        20oct87re                                          : xcor    ( - x)     xpos @ 100u/ ;      : ycor    ( - y)     ypos @ 100u/ ;                                               : setx    ( x -)     100* xpos ! ;       : sety    ( y -)     100* ypos ! ;       : setxy   ( x y -)   sety setx ;                                                  : pendown  pen on ;                      : penup    pen off ;                                                              : home                                    &160 &96 setxy &90 setheading pendown ;                                          : draw     clrscreen home &20 window ;   : nodraw   text page ;                                                                                                     ' left       Alias lt                    ' right      Alias rt                    ' setheading Alias seth                  ' pendown    Alias pd                    ' penup      Alias pu                                                            \ Tu forward back              20oct87re                                          : tline   ( x1 y1 x2 y2 -)                >r >r >r  100u/  r> 100u/                       r> 100u/  r> 100u/  line ;                                                : forward  ( distance -)                  >r xpos @ ypos @                         over deg @ cos r@ 100*/ + dup xpos !     over deg @ sin r> 100*/ + dup ypos !     pen @ IF tline ELSE 2drop 2drop THEN ;                                           : back     ( distance -)                  negate forward ;                                                                 : turtlestate ( - pen bg pc)              pen c@ colram c@ dup                     &15 and swap &16 / ;                                                             ' forward     Alias fd                   ' back        Alias bk                   ' turtlestate Alias ts                                                                                                                                             \ Gr arc ellipse circle        20oct87re                                          : arc     ( hr vr strt end -)             >r >r 2dup max &360 swap /               r> 2* 2* r> 1+ 2* 2* swap rot >r          DO over I 2/ 2/ cos &10005 */               over I 2/ 2/ sin &10005 */               plot                                  r@ +LOOP                                r> 2drop drop ;                                                                  : ellipse ( x y hr vr -)                  2swap c-y ! c-x ! m-flag on              0 &90 arc m-flag off ;                                                           : circle  ( x y r -)                      dup 3 4 */ ellipse ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ Mathematik Load-Screen       20oct87re                                          Onlyforth                                                                         base @  decimal                                                                      1  2 +thru  \ Trigonometrie              3  4 +thru  \ Wurzeln                    5  6 +thru  \ 100* 100u/                                                       base !                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ Ma sinus-table               20oct87re \    Sinus-Tabelle nach FD Vol IV/1                                               | : table    ( values n -)                Create 0 DO , LOOP                       ;code       ( n - value)                 SP X) lda  clc  1 # adc  .A asl  tay     W )Y lda  SP X) sta                      iny  W )Y lda  1 # ldy  SP )Y sta        Next jmp  end-code                                                               10000 9998 9994 9986 9976 9962 9945 9925  9903 9877 9848 9816 9781 9744 9703 9659  9613 9563 9511 9455 9397 9336 9272 9205  9135 9063 8988 8910 8829 8746 8660 8572  8480 8387 8290 8192 8090 7986 7880 7771  7660 7547 7431 7314 7193 7071 6947 6820  6691 6561 6428 6293 6157 6018 5878 5736  5592 5446 5299 5150 5000 4848 4695 4540  4384 4226 4067 3907 3746 3584 3420 3256  3090 2924 2756 2588 2419 2250 2079 1908  1736 1564 1392 1219 1045 0872 0698 0523  0349 0175 0000                                                                   &91 | table sintable                    \ Ma sin, cos, tan             20oct87re                                          | : s180   ( deg -- sin*10000:sin 0-180)  dup &90 >                                  IF &180 swap - THEN                    sintable ;                                                                       : sin     ( deg -- sin*10000)             &360 mod dup 0< IF &360 + THEN           dup &180 >                                  IF &180 - s180 negate                    ELSE s180 THEN ;                                                              : cos     ( deg -- cos*10000)             &360 mod &90 + sin ;                                                             : tan     ( deg -- tan*10000)             dup sin swap cos ?dup                      IF &100 swap */ ELSE 3 * THEN ;                                                                                                                                                                                                                                                            \ Ma sqrt 1                    20oct87re                                          Code d2*  ( d1 - d2)                      2 # lda setup jsr                        N 2+ asl N 3 + rol  N rol N 1+ rol       SP 2dec N 3 + lda SP )y sta              N 2+ lda SP x) sta                       SP 2dec N 1+ lda SP )y sta               N lda SP x) sta                          Next jmp end-code                                                                : du< &32768 + rot &32768 + rot rot d< ; | : easy-bits  ( n1 -- n2)                0 DO                                      >r d2* d2*  r@ -  dup 0<                   IF   r@ +   r> 2* 1-                     ELSE        r> 2* 3 +                    THEN LOOP ;                                                                   | : 2's-bit                               >r d2* dup 0<                             IF    d2* r@ - r> 1+                     ELSE  d2* r@ 2dup u<                      IF drop r> 1-  ELSE -  r> 1+  THEN      THEN ;                                \ Ma sqrt 2                    20oct87re                                          | : 1's-bit                               >r dup 0<                                 IF 2drop r> 1+                           ELSE d2* &32768 r@  du< 0=                 negate R> +                            THEN ;                                                                          : sqrt    ( ud1 - u2)                     0 1  8 easy-bits                         rot drop 6 easy-bits                     2's-bit 1's-bit ;                                                                \\                                                                                : xx                                      &16 * &62500 um*                         sqrt 0 <# # # # ascii . hold #s #>       type space ;                                                                                                                                                                                                                                        \ 100*                         20oct87re                                          Code 100*  ( n1 - n2)                     SP X) lda  N sta  SP )Y lda  N 1+ sta    N asl N 1+ rol  N asl N 1+ rol                                                    N lda N 2+ sta  N 1+ lda N 3 + sta                                                N 2+ asl N 3 + rol  N 2+ asl N 3 + rol   N 2+ asl N 3 + rol                                                                clc N lda N  2+ adc N sta                 N 1+ lda N 3 + adc N 1+ sta                                                      N 2+  asl N 3 + rol                                                               clc N lda N  2+ adc  SP X) sta            N 1+ lda N 3 + adc  SP )Y sta                                                    Next jmp end-code                                                                                                                                                                                                                                   \ 100/                         20oct87re                                          Label 4/+                                 N 7 + lsr N 6 + ror N 5 + ror N 4 + ror  N 7 + lsr N 6 + ror N 5 + ror N 4 + ror  clc N  lda N 4 + adc N     sta            N 1+  lda N 5 + adc N 1+  sta            SP X) lda N 6 + adc SP X) sta            SP )Y lda N 7 + adc SP )Y sta  rts                                              Code  100u/  ( u - n)                     N stx  N 4 + stx                         SP X) lda  .A asl N 1+  sta  N 5 + sta   SP )Y lda  .A rol SP X) sta  N 6 + sta   txa .A rol        SP )Y sta  N 7 + sta   4/+ jsr                                  N 7 + lsr N 6 + ror N 5 + ror N 4 + ror  4/+ jsr                                  Next jmp end-code                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \\ zu: csave cload            clv10oct87                                                                                   Der Assembler muss schon da sein                                                                                           Labels setzen                                                                                                               Parameter ab N ablegen                   SystemMeldungen ein   Status auf 0       (drv setzen fuer derror?                 Geraete#, Sek.Adresse, File#             Adresse-des-Filenamens Laenge            Adresse in XY                                                                                                              Einer der 8 Kernalfehler?                Status begucken/EOI-Bit vernichten       beides zusammen als Fehler# zurueck                                                                                                                                                                                                                 \\ zu: ..csave cload          clv10oct87                                                                                    Parameter vorbereiten (XR=to+1)          Zeiger auf from in AR und BSAVE          Fehler?                                                                                                                    Parameter vorbereiten (XR=from)          Load (nicht Verify) BLOAD                to+1 wird zurueckgegeben und             sorgfaeltig auf den Forth-Stack getan    Fehler?                                                                                                                                                            Fehlerfundstellen bei CBM-Routinen:      (1) Kernal-Rueckgabe                     (2) Status-Register                      (3) Disketten-Fehlerkanal                                                                                                                                                                                                                            \\ zu: ..csave cload Luxus    clv10oct87                                                                                                                            Dieser Routine proekelt sich die         Basic-Fehlermeldungen raus, damit        ich nicht alles nochmal abschreiben      muss. Dazu benutzt sie das Basic-Rom,    was man nur machen sollte, wenn sicher   keine Seiteneffekte auftreten!           Dies ist hier der Fall.                                                                                                                                                                                                                               macht aus der zurueckgegebenen Nummer:   eine Fehlerausgabe                       Wenn nicht grade "device not presen"     ist, fragt es auch noch den seriellen    Bus nach des Geraetes Fehlermeldung                                                                                                                                                                         \\ zu TapeVersion             clv01aug87                                          Die Kassettenversion wurde speziell      fuer C16 mit 64kB entwickelt, laueft     aber auch auf C64.                                                                Sie besteht auf 3 Teilen:                   Einer im Speicher simulierten Floppy     Einer Schnittstelle zum externen           Geraet (i.a.Recorder)                  Einem Schnelllader (Supertape)             (allerdings nur fuer C16)                                                                                                                                                                               Initialisieren:                           ggf. Supertape initialisieren            R/W umdefinieren und aktivieren          falls AUTOLOAD gesetzt ist, gleich       noch eine ramdisk laden.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   \\ zu RD: loadscreen          clv05aug87                                          Die hier vorgestellte Ramdisk benutzt    ein komprimierendes Format.                                                       Um ein Umschalten zwischen mehreren      Ramdisk's zu ermoeglichen, enthaelt die  einzige Variable (RD einen Zeiger        auf die Ramdisk, alle weiteren           Variablen stehen im Speicherbereich      der Ramdisk.                                                                      Binaerbloecke muessen mit BINARY         deklariert werden, ansonsten unter-      stuetzt die Ramdisk alle Forth-Worte,    die ueber R/W gehen.                                                                                                                                                                                                                                                                                                                                                                                                     \\ zu RD:                     clv01aug87                                          \ Alle Zeiger sind offsets auf First                                              rd ==0 ==>   keine Ramdisk                                                        rd -->Laenge des Parameterblock          +2 -->aktueller Block                    +4 -->Ende des letzten Blocks+1          +6 -->Ende des Ramdisk-Bereich+1         +8 -->Nummer des aktuellen Blocks        +16-->Name                               Ende des Parameterblocks                      1.RD-Block                               2.RD-Block                                 .                                      0000                                                                         adr-->aktueller RD-Block (absolute Adr.)    -->Laenge (incl. 4 bytes Verwaltung)   2+-->Blocknummer                         2+-->..Daten..                                                                                                                                                    \\ zu RD:                     clv01aug87                                          NEW prueft ob genug Platz ist                und setzt aktuellen Block                auf den ersten freien Platz                                                                                            LEN! Traegt die Laenge des neuen             Blocks ein und veraendert END            Wenn die Laenge=0 ist, geschieht nix     Erzeugt 0000 am Ende der Ramdisk                                              LEN@ gibt die Laenge des aktuellen           Blocks zurueck. Wenn er nicht            vorhanden ist, gibt es 0 zurueck                                              DEL Loescht den aktuelen Block               Veraendert END                                                                                                                                                                                                                                                                                                                     \\ zu RD:                     clv01aug87                                          SEARCH setzt akt. auf gesuchten Block      Wenn nicht vorhanden: auf END            Legt BlockNummer in BLK# ab.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                BINARY untersagt das Komprimieren des      Blocks z.B. fuer Binaerdaten.            Wird durch $400 Bytes Laenge erkannt.                                                                                                                                                                     \\ zu RD: c>7 7 >c            clv01aug87                                          Umwandeln der CBM-Zeichen in 7bit        Die Zeichen $c0..$e0 werden zu $60..80   Alle anderen Zeichen >=$80  zu $00..20                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      \\ zu RD: cp1 cp2             clv01aug87                                          Anfangsroutine fuer COMPRESS & EXPAND                                                                                                                                                                                                                                                          Endroutine fuer COMPRESS & EXPAND                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              \\ zu RD: expand compress     clv01aug87                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \\ zu RD:ramR/W               clv01aug87                                          ENDWRITE entfernt Blanks am Blockende       und setzt LEN!                                                                                                                                                   ENDREAD fuellt Rest des Blocks mit Blank                                                                                   RAMR/W  ersetzt die R/W-Routine            (binaere) Bloecke mit voller Laenge      werden per CMOVE uebertragen.            Kuerzere werden beim Schreiben           mit COMPRESS und beim Lesen mit          EXPAND verarbeitet.                                                                                                                                                                                                                                                                                                                                                                                                    \\ zu RD:id rduse..           clv01aug87                                          .RD  gibt die zentralen Kenndaten             der Ramdisk aus                                                              ID!  setzt den Namen                                                                                                                                                                                         ID"  liest den Namen ein                                                          RDUSE schaltet (ohne Pruefung) um        RDDEL loescht die Ramdisk                                                                                                                                           RDNEW erzeugt eine neue Ramdisk                und prueft (fast) alles                                                                                                                                                                                                                                                                 \\ zu RD: rdcheck             clv01aug87                                                                                                                            RDCHECK prueft die Zeiger der Ramdisk            und gibt eine Inhaltsuebersicht                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \\ zu ST:LoadScreen           clv01aug87                                          Supertape ist ein Schnell-Lader, der     mit 3600 Bd oder 7200 Bd ca. 10 mal      so schnell wie die entsprechende CBM-    Routine ist.                              Bedienung:                                GeraeteNummer =  7 ==> Supertape         SekundaerAddr>=$80 ==> 7200 Bd                         <$80 ==> 3600 Bd                         ..sonst wie CBM                                                   Aufzeichnung:8 Bit pro Byte, Niederwerti ge bit zuerst. Selbsttaktierend: An      jeder Bitgrenze ist ein Flankenwechsel.  Wenn in der Mitte dazwischen auch einer  ist ist das Bit=0, sonst=1.                                                       Format: sync #$2a 25b:Header 2b:checksum         sync #$c5 len:Daten  2b:checksum Sync  = 64b:#$16                         Header=16b:Name                                 1b:SekAdd 2b:from 2b:len 4b:#$00                                                                                   \\ zu ST:Labels..             clv16jun87                                          -------- hardware-Adressen -----------   1  Cassettenport                         2  Zeit fuer Timer2                      1  kontrollregister fuer Timer2          1  Schreibzugriff schaltet auf RAM       1  Schreibzugriff schaltet auf ROM                                                -------- System-Vektoren -------------   2  Save-Vektor des Systems wird verbogen 2  Load-Vektor des Systems wird verbogen                                          ----- Eingabe-Parameter Load/Save-----   1  Geraete-Nummer                        1  Sekundaeradresse (steuert Geraet)     2  Zeiger auf Filenamen                  1  Anzahl der Zeichen im Filenamen       2  Anfangsadresse fuer LOAD              2  Anfangsadresse fuer SAVE              2  Endadresse+1   fuer SAVE                                                       ----- Ausgabe-Parameter von Load/Save -- 1  Status Flags des Betr.sys                                                     \\ zu ST:..Labels             clv16jun87                                          -------- benutzte System-Routinen -----     Kassetten-Motor einschalten              Kassetten-Motor einschalten              Kassetten-Port init                      Kassetten-Port init                      normale Load-Routine                     normale Save-Routine                     gibt 'Loading' oder 'Verifying' aus      gibt 'Press play..' aus                  gibt 'Press Record.. ' aus               gibt 'Found' aus                         gibt 'Searching' aus                     gibt ein Zeichen aus                                                           -------- benutzte Zeropage-Adressen----                                           2  Adresse des aktuellen I/O  Bytes      2  Adresse des letzten   i/O  Bytes+1    1  naechsten Block: Verify/-Laden        1  naechster Block: Header/Daten         1  letzter Zustand des Kassettenports    1  bereits geladener Teil des akt.Bytes  1  letztes geladenes Byte               \\ zu ST:..Labels             clv16jun87                                                                                   2  kurzer/langer Impuls bei Save         2  Checksumme                                                                     1  Stackpointer fuer Fehleraustritt                                                                                        ----- sonstige Systemadressen -------    1  Zeit fuer naechsten TimerBStart       c0 Puffer fuer Kassettenoperationen      -  Ende des Puffers, Low-Byte                                                     ----------- Konstanten --------------       GeraeteNummer von Supertape              1.Byte eines Headerblocks                1.Byte eines Datenblocks                 Zeit 7600 Baud laden                     Zeit 3600 Baud laden                     Zeit 7600 Bd saven lang/kurz-Impuls      Zeit 7600 Bd saven lang/kurz-Impuls      Byte fuer Synchronisierungs-Vorspann     min. Anzahl von SyncBytes beim Laden     Anzahl von SyncBytes beim Saven      \\ zu ST:verschiedenes        clv28jul87                                          Beginn des Bootstraploaders                                                                                                                                                                                                                                                                                                                                                       (1)                                     Startet Timer Nummer 2                    (1)                                     mit Zeit in STIME                                                                                                                                                                                            WarteSchleife                                                                     (1) die Sequenz'brk brk bit brk brk'         stoppt oft das Selbstueberschreiben      beim Booten, wenn ein Lesefeher          aufgetreten ist                     \\ zu ST:stEnde etc.          clv18jun87                                                          kein  Fehler (Bit--)                     Load-     "  (Bit--)      AR := FehlerNr EOT -     "  (Bit--)                     Verify-   "  (Bit--)                     Stop-     "               Auf Rom zurueckschalten, Fehler pushen   Port exit                                Stack reparieren                         xr-yr := Lade-EndAdresse                 CF    := Fehler , Interrupt wieder an                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \\ zu ST:bitLesen             clv16jun87                                                                                   warten bis Timer abgelaufen       (?)    Carry := 1 , wenn Pegel gleich == Bit=1   abspeichern                              in Byte rotieren                        wenn Bit=1: Checksumme inkremtentieren   Auf taktierende Flanke warten            Portzustand merken ,Timer neu setzen     akt.Byte zurueckgeben                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \\ zu ST:stRead..             clv28jul87                                           Daten/oder Header,Verifyfehler := 0                                                                                        einsyncronisieren                                                                 Byte lesen                                                                        kein Syncron.Byte? dann neu suchen                                                bis Vorspann sicher erkannt                 Byte Lesen                               bis Vorspann zuende ist AR=Blockart   gesuchte BlockArt? dann lesen            Header gesucht Dat. gef.? weitersuchen   andre Art? Fehler                        Checksumme := 0                          Byte Lesen                                                                                                                                                                                                                                                                                   \\ zu ST:..stRead             clv28jul87                                          --- Schleife von Lade-Anfang bis Ende     Pruefsumme                                           := Checksumme                2 Bit Lesen                              nur Verify?                              sonst: Byte laden                        2 Bit lesen                              Byte vergleichen                         Verifyfehler hochzaehlen                 2 Bit Lesen                              Zeiger auf naechstes Byte                2 Bit lesen                              neues Byte                              --- Schleifenende                        --- Schleifenende                                                                                                                                                                                                                                                                                                                                                               \\ zu ST:..stRead             c2v27jul87                                           Pruefsummen-Fehler?                        dann Status                              und  LoadFehler-Exit                   Byte lesen                                                                        Pruefsummen-Fehler?                      Verifyfehler?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \\ zu ST:stLoad..             clv16jun87                                          wird Load-Vektor des Systems              Verify/Load merken; Status loeschen      fuer Supertape?                          wenn nicht -> CBM-Routine                Stack fuer Fehlerbeh. sichern            'Press play on Tape' Stop?,dann return   Int. aus                                 auf Laden stellen                        'Searching...'                                                                    Initialisieren                                                                    3600 Baud/Laden                          Header suchen und Laden                  'Found ..'                               FileNamen ausgeben                                                                                                                                                                                                                                                                                                                    \\ zu ST:..stLoad             clv16jun87                                                                                                                             alle angegebenen Zeichen vergleichen                                               Zeichen wie in angeg. Filenamen?                                  dann weiter     angeg. Zeichen '?'  ?    dann weiter     End-Of-Tape         ?                                             dann NotFound   sonst: Bildschirm an, weitersuchen      VerifyFlag reparieren                    'loading'/'verifying'                    LadeAddresse := vom System uebergeben                                             SekAdd.=1?                                                                          dann Ladeaddresse aus Header                                                    LadeEnde                                         :=                                           LadeAddresse                            +FileLaenge                                                          \\ zu ST:..stLoad             c2v27jul87                                                                                    7200 Baud/Laden setzen                   mit 3600 Bd gesaved (==Sekadd>$80)?      dann 3600 Bd/Laden setzen                auf Ram schalten, Datenblock laden       Ende                                                                             Wird fuer Bootstraplader gebraucht                                                                                                                                                                           Erzeugt einen String der Form 'g78b5',   mit der Adresse LOADSYS                  der als Monitor-befehl verwendet,        die Startadresse des Bootstraploaders    angibt. s.a. SAVEBOOTER                                                           Dieser String darf keine Grossbuchstaben enthalten                                                                                                                                                          \\ zu ST:wByte w4bits         clv16jun87                                                                                                                             4 Bits                                   --- Schleife ueber 4 Bits                   bit=1?, dann volle  Zeit setzen          Auf Timer warten                         neu starten                              Flanke schreiben                         bit=0?                                      auf Timer warten                         und neu starten                          Flanke schreiben (Bit-Grenze)         bit=1?                                      Checksumme hochzaehlen                                                                                                     halbe Zeit setzen                  --- Schleife Ende                                                                                                                                                                                                                                   \\ zu ST:stWrite              clv18jun87                                           AR=Blockart                              sichern                                  SynchronisationsBytes                    ..schreiben                              Blockart schreiben                       Checksumme := 0                          --- Schleife von 1. bis letztes Byte                       untere 4 Bits                            obere 4 Bits schr.     --- Schleife..                           --- ..Ende                               Checksumme..                             ..Low  Byte schreiben                    ..High Byte schreiben                    paar Extrabits, damit Laden immer endet                                                                                                                                                                                                                                                                                                                                        \\ zu ST:saveName             clv01aug87                                          schreibt FileNamen in KassettenPuffer     CassettenPuffer [0..$10]                              := <blanks>                 CassettenPuffer [0..FileNameLaenge]                   :=                                          FileName                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        \\ zu ST:stSave..             clv01aug87                                          wird als Betr.Sys-Vektor eingetragen      GeraeteNr = Supertape?                   sonst: was das soll weiss ich nicht         CBM-Save-Routine                      StackPointer fuer Fehlerbehandlung       FileName in Buffer                       ' Press Play & Record on Tape'  STOP?    Initialisieren                                                                                                             Startadresse in Buffer -- aendern???                            -- fuer COPY?     FileLaenge                               ..berechnen                              ..und                                    ..in Buffer schreiben                    CassBuffer [$21..$24]                                              := 0           Zeit-HighByte := 0                       SaveAnfangsAdresse                                     := CassettenPuffer         SaveEndeAdresse                                        := Cassett.Puffer-Ende   \\ zu ST:..STSave             clv01aug87                                                                                    3600Baud/kurzer SaveImpuls (==Bit=0)             /langer SaveImpuls (==Bit=1)     setzen                                   TimerNummer2   an                        Vorspann(==Buffer) schreiben             Pause schreiben                          7200Bd gewuenscht (==SekAdd>=$80) ?      dann 7200Bd/kurzer SaveImpuls                       /langer SaveImpuls                 setzen                              SaveAnfangsAdresse                                 := vom System uebergeben       SaveEndeAdresse                                    := vom System uebergeben       Ram ein , DatenBlock schreiben           Pause schreiben fertig                                                                                                                                                                                                                                                                       \\ zu ST:supertape stSavSys   clv10oct87                                          SUPERTAPE                                .. setzt aktuelles Geraet                .. aendert Betriebssystem Vektoren       .. und gibt Meldung aus                                                           !! Ein Supertape-System muss in 3 Teilen !! gesichert werden:                     !!  1. Mini-Supertape                    !!  2. Teil des Systems davor            !!  3. Teil des Systems dahinter         !! Der 1.Teil wird im CBM-Format gesich. !! und laedt dann 2.&3. im ST-Format.                                               An den eingelesenen Filenamen            das gLOADSYS anhaengen.                                                                                                    1. von PUFFINIT bis exkl. BTL            im CBM-Format sichern                    ST-Format nehmen                         2. sichern                               3.   "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         \ Sieve benchmark              20oct87re                                          Onlyforth                                                                         : allot  ( u --)                          dup sp@ here - $180 -  u>                abort" no room" allot ;                                                          &8192 Constant size                      Create flags   size allot                : do-prime  ( -- #primes )                flags size 1 fill    0                   size    0 DO flags I + c@                          IF  I 2* 3+ dup I +                        BEGIN  dup size <                        WHILE  0 over flags + c!                        over +                            REPEAT  2drop 1+                       THEN                                  LOOP ;                           : benchmark   9 0 DO do-prime drop  LOOP  do-prime . ." Primzahlen" ;             : .primes   size 0 DO  flags I + c@       IF  I 2* 3+ .  THEN ?cr                  stop? IF  LEAVE  THEN  LOOP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ Graphic-Demos Loadscreen     20oct87re                                          Only Forth also definitions                                                       \needs Graphic -&80 +load                                                         Graphic also definitions                  page  .( Loading .....)                                                           1   4 +thru   \ Demo1,2,3,4 Demo         5     +load   \ Sinplot                  6 &11 +thru   \ Turtle demos                                                                                              wellen wellen1 dreieck linien moire      sinplot                                  ornament circles schnecke spirale        siedlung                                                                          &20 window                                                                                                                                                                                                                                           \ Plot wellen                  20oct87re                                          &100 | Constant &100                     &160 | Constant &160                     : wellen                                  cs red cyn colors hires                  &100 0 DO                                &99 0 DO                                   I dup * J dup * + &150 / 1 and            IF &160 J + &100 I + plot                   &160 J - &100 I + plot                   &160 J - &100 I - plot                   &160 J + &100 I - plot THEN         LOOP LOOP ;                                                                     : wellen1                                 cs blu yel colors hires                  &160 0 DO                                &99 0 DO                                   I dup * J dup * + 100u/ 1 and 0=          IF &160 J + &100 I + plot                   &160 J - &100 I + plot                   &160 J - &100 I - plot                   &160 J + &100 I - plot THEN         LOOP LOOP ;                           \ lineplot dreieck             20oct87re                                          | : grinit                                clrscreen                                yel blu colors hires ;                                                           : dreieck                                 grinit                                   0 2 DO                                     &160 0 DO                                   I &199 &160 I 2/     J + flipline     &320 I - &199 &160 I 2/ J + flipline     2 +LOOP                                -1 +LOOP text ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ lineplot linien moire        20oct87re                                          : linien                                  grinit                                   &320 0 DO                                   &320 0 DO I &198 J 0 line &35 +LOOP   &35 +LOOP ;                                                                      : moire                                   clrscreen ora red colors hires           &320 0 DO                                 I &198 &319 I - 0 line                  3 +LOOP                                  &199 0 DO                                 &319 &198 I - 0 I line                  2 +LOOP ;                                                                                                                                                                                                                                                                                                                                                                                                               \ lineplot boxes               20oct87re                                          Variable x0       Variable y0            Variable x1       Variable y1                                                     : box   ( x1 y1 x0 y0 -)                  y0 ! x0 ! y1 ! x1 !                      x1 @ y0 @ x0 @ over flipline             x1 @ y1 @ over y0 @ flipline             x0 @ y1 @ x1 @ over flipline             x0 @ y0 @ over y1 @ flipline ;                                                   Create colortab                           blk c, lbl c, red c, lre c,              pur c, grn c, blu c,                                                             : boxes                                   grinit                                   &10 3 DO                                  &160 0 DO I dup &318 I - &198 I - box          J +LOOP                             I 3 - colortab + c@  pencolor            LOOP ;                                                                                                                 \ Graphic sinplot              20oct87re                                          &10000 Constant 10k                                                               : sinplot                                 grinit                                   &319  &96   0 &96 line                   &160 &197 &160  0 line                   &152 &160 negate DO                       I &160 + &96 I sin &96 10k */ +          I &168 + &96 I 8 + sin &96 10k */ +      line                                    8 +LOOP                                  &152 &160 negate DO                       I &160 + &96 I cos &96 10k */ +          I &168 + &96 I 8 + cos &96 10k */ +      line                                    8 +LOOP  ;                                                                                                                                                                                                                                                                                                                            \ Turtle demos                 20oct87re                                          | : tinit    ( -- )                       clrscreen  hires   \ showturtle          red cyn colors ;                                                                 | : shome  ( -- )                         tinit &65 0 setxy &90 seth pendown ;                                             : vieleck   ( length edges -- )           &360 over /                              swap 0 DO  over forward                             dup right     LOOP 2drop ;                                            | : ring  ( edges -- )                    &200 over / swap                         &18 0 DO  2dup vieleck                            &20 right  LOOP  2drop ;                                                : ornament  ( -- )                        tinit home                               &10 3 DO  clrscreen  I dup 7 -                    IF  ring  ELSE  drop  THEN               LOOP ;                                                                 \ Turtle demos 1               20oct87re                                          : circles  ( -- )                         tinit                                     2 -1 DO home                              &10 0 DO                                  &20 I 2* - &20 vieleck                   xcor &10 I 2/  - - setx                  ycor &10 I - J * - sety                 LOOP                                    2 +LOOP ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ Turtle demos 2               20oct87re                                          | : (schnecke  ( length -- )  recursive   dup 5 < IF  drop exit  THEN              dup forward &90 right                    2- (schnecke ;                                                                   : schnecke  ( -- )                        shome &190 (schnecke ;                                                           | : (spirale  ( length -- )  recursive    dup 5 < IF drop exit THEN                dup forward &91 right                    2- (spirale ;                                                                    : spirale  ( --)                          shome 5 forward &190 (spirale ;                                                                                                                                                                                                                                                                                                                                                \ Turtle demos 3               20oct87re                                          | : startpos                              &15 0 setxy &90 setheading ;                                                     | : weiter  ( -- )                        &90 right penup &55 forward              pendown &90 left ;                                                               | : kamin                                 xcor ycor                                &50 fd &30 rt &15 fd &30 lt              &30 fd &90 rt &12 fd &90 rt  8 fd        setxy &90 setheading ;                                                           | : haus                                  &50 4 vieleck &50 forward  &30 right     &50 3 vieleck &30 left  &50 back         &90 right &15 forward &90 left           &20 4 vieleck                            &90 left &15 forward &90 right           kamin ;                                                                                                                                                           \ Turtle demos 4               20oct87re                                          | : hausreihe                             tinit startpos                           4 0 DO haus weiter LOOP haus ;                                                   | : fenster                               xcor ycor                                penup &30 fd &90 rt &10 fd &90 lt        pendown                                  &10 4 vieleck &90 rt                     penup &20 fd &90 lt                      pendown &10 4 vieleck                    setxy ;                                                                          : siedlung   hausreihe                    startpos 4 0 DO fenster weiter LOOP      fenster ;                                                                                                                                                                                                                                                                                                                             \ Turtle demos 5               20oct87re                                          | : (orden   ( len grad -- ) recursive    stop? 0= and ?dup                        IF  over 3 / swap 1-                      4 0 DO 2dup (orden 2 pick forward               &90 right  LOOP 2drop             THEN drop ;                                                                     : orden                                   tinit shome &192 5 (orden ;                                                      \\                                                                                : (6orden   ( len grad -)  recursive      ?dup IF  over 3 / swap 1-                 6 0 DO 2dup (6orden 2 pick forward              &60 right  LOOP 2drop             THEN drop ;                                                                     : 6orden                                  tinit shome &80 &55 setxy                &85 3 (6orden ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          \ Sprite-Demo                  23oct87re                                          \needs graphic   -&96 +load                                                       Onlyforth graphic also  Forth                                                     .( Loading...)                                                                      1   4 +thru                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           \ Sprite-Demo                  20oct87re                                          Create Shapes  5 $40 * allot              blk @ 4 +  block                         Shapes  5 $40 * cmove                                                            : init  ( -)                              graphic page                             blu border  blu background               5 0 DO                                       Shapes  I $40 * +  I getform LOOP    grn wht sprcolors                        5 0 DO  I 0 0 wht I setsprite  LOOP      5 0 DO  I small  I high  I 3colored set          I behind LOOP  ;                                                                                                                                                                                                                                                                                                                                                                                                                                         \ Sprite-Demo                  20oct87re                                          : ypos  ( spr# - y)  sprpos drop ;                                                : xpos  ( spr# - x)  sprpos nip ;                                                 &26 Constant Distance                                                             : 1+0-1  ( n - +1/0/-1)                   dup 0= not swap 0< 2* 1+ and ;                                                   : follow-sprite ( spr# -)                >r r@ xpos  r@ 1- xpos  Distance +          over -  1+0-1 + &344 min  r@ xmove       pause                                    r@ ypos  r@ 1- ypos                      over -  1+0-1 +           r> ymove       pause ;                                                                                                                                                                                                                                                                                                                             \ Sprite-Demo                  20oct87re                                          : follow-cursor  ( spr# -)               >r r@ xpos  Col 8 * &33 +                   over -  1+0-1 +  r@ xmove  pause         r@ ypos  Row 8 * &59 +                   over -  1+0-1 +  r> ymove  pause ;                                             : follow  ( spr# -)                      pause  dup IF   follow-sprite                       ELSE follow-cursor THEN ;                                              : killsprites  ( -)  0 sprite c! ;                                                : slide-sprites  ( -)                    5 0 DO  I follow  I 1+ 0 DO  I follow    LOOP LOOP ;                                                                       \\                                                                                : testslide ( -)                         init BEGIN  slide-sprites                            key dup con!  3 = UNTIL ;                                                                                     \ Sprite-Demo                  20oct87re                                          \needs tasks   .( Tasker? ) \\                                                    $100 $100 Task Demo                                                               : slide  ( -)                             Demo activate                            init BEGIN  slide-sprites  REPEAT ;                                              : endslide  ( -)                          killsprites  Demo activate  stop ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ªªª•uv•uv•ªª•€ •€ •ª •u`•u`•ª •€ •€ •€ •€ •€ •€ •€ ª€          ªª€	u`%ux•Év•‚v•‚v•‚v•‚v•‚v•‚v•‚v•‚v•‚v•‚v•Év%ux	u`ª€         ªªª€•u`•ux•©v•‚v•‚v•©v•ux•u`•¥`•¥`•‰x•‰x•‚v•‚v•‚v•‚vª‚ª         ªªªª•uv•uvªvªv v v v v v v v v v v v v ª          ªª‚ª•‚v•‚v•‚v•‚v•‚v•ªv•uv•uv•ªv•‚v•‚v•‚v•‚v•‚v•‚v•‚vª‚ª         ª                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \ tiny sprite editor           06nov87re                                          Onlyforth Graphic also definitions                                                \needs sprbuf  Create sprbuf $100 allot  \needs >byte : >byte $100 /mod ;                                                  | Variable cbase  2 cbase !                                                       | : width ( -- n )  &16 cbase @ / ;                                               | : (l: ( -- )                            base push  cbase @ base !                name number  name number drop            >r  >byte drop  r@ c!                    >byte r@ 1+ c!  r> 2+ c! ;                                                       : l: (l: quit ;                                                                   : #.r  ( n width -- )                     >r 0 <#  r> 0 DO  #  LOOP  #> type ;                                             : arguments  ( n -- )                     depth < not abort" Arguments?" ;                                            --> \ tiny sprite editor           06nov87re                                          | Create savearea $1A allot              | Variable xsave    | Variable ysave     | Variable saved    saved off                                                     | : savesprites  ( -- )                   saved @ ?exit                            sprite savearea $1A cmove  0 sprite c!   7 sprpos xsave ! ysave ! saved on ;                                              : fertig  ( -- )                          saved @ not ?exit                        ysave @ xsave @ 7 move                   savearea sprite $1A cmove saved off ;                                            | : sprline  ( adr line -- )              base push  dup 2* + +  cr                ." l: "  cbase @ base !                  dup count width #.r  count width #.r     c@ width #.r  ." . $" hex 4 #.r ;                                                                                                                                                                      --> \ tiny sprite editor           06nov87re                                          | : slist  ( mem# -- )                    $40 * sprbuf +                           &21 0 DO  dup I sprline                            stop? IF  LEAVE  THEN  LOOP    drop cr  ." fertig"  0 0 at quit ;                                               : sed  ( mem# -- )                        1 arguments  &32 min                     page dup . ." sed \ 1 color"             savesprites  2 cbase !                   dup $40 $128 yel 7 setsprite             7 3colored reset  7 big  slist ;                                                 : ced  ( mem# -- )                        1 arguments  &32 min                     page dup . ." ced \ 3 colors"            savesprites  4 cbase !                   blk gr2 sprcolors                        dup $40 $128 yel 7 setsprite             7 3colored set  7 high  slist ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   